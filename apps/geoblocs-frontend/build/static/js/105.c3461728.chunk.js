"use strict";(self.webpackChunkgeoblocs=self.webpackChunkgeoblocs||[]).push([[105],{30105:function(t,e,r){r.r(e),r.d(e,{SmartWalletConnector:function(){return nt}});var n=r(4942),a=r(1413),s=r(88301),i=r(61120),c=r(29439),u=r(97326),o=r(60136),p=r(29388),h=r(74165),f=r(43144),l=r(15671),d=r(15861),v=r(36624),x=r(30520),m=r(49716),g=r(88062),y=r(65054),w=r(2257),k=r(42412),Z=r(2273),b=r(34029),A=r(68408),P=r(9970),T=r(68624),I=r(22876),O=r(97419),G=r(83374),C=r(6222),U=r(27591),E=r(16070),L=r(24612),_=r(63952),D=r(17591),F=r(18392),N=r(12644),S=r(31074),B=r(91423),K=r(29278);r(30656);function R(t){return H.apply(this,arguments)}function H(){return(H=(0,d.Z)((0,h.Z)().mark((function t(e){var r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.resolveProperties(e);case 2:return r=t.sent,t.abrupt("return",Object.keys(r).map((function(t){var e=r[t];return"string"===typeof e&&e.startsWith("0x")||(e=m.hexValue(e)),[t,e]})).reduce((function(t,e){var r=(0,c.Z)(e,2),s=r[0],i=r[1];return(0,a.Z)((0,a.Z)({},t),{},(0,n.Z)({},s,i))}),{}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function $(t,e,r){return W.apply(this,arguments)}function W(){return(W=(0,d.Z)((0,h.Z)().mark((function t(e,r,n){var s,i,c,u,o,p;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.resolveProperties(e);case 2:return s=t.sent,i={sender:s.sender,nonce:s.nonce,initCodeHash:g.keccak256(s.initCode),callDataHash:g.keccak256(s.callData),callGasLimit:s.callGasLimit,verificationGasLimit:s.verificationGasLimit,preVerificationGas:s.preVerificationGas,maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas,paymasterAndDataHash:g.keccak256(s.paymasterAndData)},c={components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes32",name:"initCodeHash"},{type:"bytes32",name:"callDataHash"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes32",name:"paymasterAndDataHash"}],name:"hashedUserOp",type:"tuple"},u=y.$.encode([c],[(0,a.Z)({},i)]),o=g.keccak256(u),p=y.$.encode(["bytes32","address","uint256"],[o,r,n]),t.abrupt("return",g.keccak256(p));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var V=function(){var t=function(){var t=BigInt(Math.floor(4294967296*Math.random())),e=BigInt(Math.floor(4294967296*Math.random())),r=BigInt(Math.floor(4294967296*Math.random())),n=BigInt(Math.floor(4294967296*Math.random())),a=BigInt(Math.floor(4294967296*Math.random())),s=BigInt(Math.floor(4294967296*Math.random()));return t<<BigInt(160)|e<<BigInt(128)|r<<BigInt(96)|n<<BigInt(64)|a<<BigInt(32)|s}().toString(16);return t.length%2!==0&&(t="0"+t),t="0x"+t,w.O$.from(m.concat([t,"0x0000000000000000"]))},M=(0,f.Z)((function t(){(0,l.Z)(this,t)})),z=function(){function t(e,r,n,a,s){(0,l.Z)(this,t),this.bundlerUrl=e,this.entryPointAddress=r,this.chainId=n;var i={};if((0,U.i)(this.bundlerUrl)){var c="undefined"!==typeof globalThis&&"APP_BUNDLE_ID"in globalThis?globalThis.APP_BUNDLE_ID:void 0;s?i["x-secret-key"]=s:a&&(i["x-client-id"]=a,c&&(i["x-bundle-id"]=c)),"undefined"!==typeof globalThis&&"TW_AUTH_TOKEN"in globalThis&&"string"===typeof globalThis.TW_AUTH_TOKEN&&(i.authorization="Bearer ".concat(globalThis.TW_AUTH_TOKEN)),"undefined"!==typeof globalThis&&"TW_CLI_AUTH_TOKEN"in globalThis&&"string"===typeof globalThis.TW_CLI_AUTH_TOKEN&&(i.authorization="Bearer ".concat(globalThis.TW_CLI_AUTH_TOKEN),i["x-authorize-wallet"]="true"),(0,E.s)(i)}this.userOpJsonRpcProvider=new k.c({url:this.bundlerUrl,headers:i},{name:"Connected bundler network",chainId:n}),this.initializing=this.validateChainId()}return(0,f.Z)(t,[{key:"validateChainId",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.userOpJsonRpcProvider.send("eth_chainId",[]);case 2:if(e=t.sent,(r=parseInt(e))===this.chainId){t.next=6;break}throw new Error("bundler ".concat(this.bundlerUrl," is on chainId ").concat(r,", but provider is on chainId ").concat(this.chainId));case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"sendUserOpToBundler",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initializing;case 2:return t.next=4,R(e);case 4:return r=t.sent,n=[r,this.entryPointAddress],t.next=8,this.printUserOperation("eth_sendUserOperation",n);case 8:return t.next=10,this.userOpJsonRpcProvider.send("eth_sendUserOperation",[r,this.entryPointAddress]);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"estimateUserOpGas",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initializing;case 2:return t.next=4,R(e);case 4:return r=t.sent,n=[r,this.entryPointAddress],t.next=8,this.printUserOperation("eth_estimateUserOperationGas",n);case 8:return t.next=10,this.userOpJsonRpcProvider.send("eth_estimateUserOperationGas",[r,this.entryPointAddress]);case 10:return a=t.sent,t.abrupt("return",{preVerificationGas:w.O$.from(a.preVerificationGas),verificationGas:w.O$.from(a.verificationGas),verificationGasLimit:w.O$.from(a.verificationGasLimit),callGasLimit:w.O$.from(a.callGasLimit).add(L.M)});case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getUserOperationGasPrice",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initializing;case 2:return t.next=4,this.userOpJsonRpcProvider.send("thirdweb_getUserOperationGasPrice",[]);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getUserOperationReceipt",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initializing;case 2:return t.next=4,this.userOpJsonRpcProvider.send("eth_getUserOperationReceipt",[e]);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"printUserOperation",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}]),t}(),J=function(t){(0,o.Z)(r,t);var e=(0,p.Z)(r);function r(t,n,a,s){var i;return(0,l.Z)(this,r),(i=e.call(this)).paymasterUrl=t,i.entryPoint=n,i.clientId=a,i.secretKey=s,i}return(0,f.Z)(r,[{key:"getPaymasterAndData",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a,s,i,c,u,o;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r={"Content-Type":"application/json"},!(0,U.i)(this.paymasterUrl)){t.next=8;break}if(!this.secretKey||!this.clientId){t.next=4;break}throw new Error("Cannot use both secret key and client ID. Please use secretKey for server-side applications and clientId for client-side applications.");case 4:this.secretKey?r["x-secret-key"]=this.secretKey:this.clientId&&(r["x-client-id"]=this.clientId,(n="undefined"!==typeof globalThis&&"APP_BUNDLE_ID"in globalThis?globalThis.APP_BUNDLE_ID:void 0)&&(r["x-bundle-id"]=n)),"undefined"!==typeof globalThis&&"TW_AUTH_TOKEN"in globalThis&&"string"===typeof globalThis.TW_AUTH_TOKEN&&(r.authorization="Bearer ".concat(globalThis.TW_AUTH_TOKEN)),"undefined"!==typeof globalThis&&"TW_CLI_AUTH_TOKEN"in globalThis&&"string"===typeof globalThis.TW_CLI_AUTH_TOKEN&&(r.authorization="Bearer ".concat(globalThis.TW_CLI_AUTH_TOKEN),r["x-authorize-wallet"]="true"),(0,E.s)(r);case 8:return t.t0=fetch,t.t1=this.paymasterUrl,t.t2=r,t.t3=JSON,t.next=14,R(e);case 14:return t.t4=t.sent,t.t5=this.entryPoint,t.t6=[t.t4,t.t5],t.t7={jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:t.t6},t.t8=t.t3.stringify.call(t.t3,t.t7),t.t9={method:"POST",headers:t.t2,body:t.t8},t.next=22,(0,t.t0)(t.t1,t.t9);case 22:return a=t.sent,t.next=25,a.json();case 25:if(s=t.sent,a.ok){t.next=30;break}throw i=s.error||a.statusText,c=s.code||"UNKNOWN",new Error("Paymaster error: ".concat(i,"\nStatus: ").concat(a.status,"\nCode: ").concat(c));case 30:if(!s.result){t.next=39;break}if("string"!==typeof s.result){t.next=36;break}return t.abrupt("return",{paymasterAndData:s.result});case 36:return t.abrupt("return",s.result);case 37:t.next=41;break;case 39:throw o=(null===(u=s.error)||void 0===u?void 0:u.message)||s.error||a.statusText||"unknown error",new Error("Paymaster error from ".concat(this.paymasterUrl,": ").concat(o));case 41:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(M),j=function(t,e,r,n){return new J(t,e,r,n)},q=function(){function t(e,r,n,a,s,i,c){(0,l.Z)(this,t),this.resolve=e,this.reject=r,this.entryPoint=n,this.sender=a,this.userOpHash=s,this.nonce=i,this.timeout=c,(0,D._)(this,"resolved",!1),this.boundLisener=this.listenerCallback.bind(this)}return(0,f.Z)(t,[{key:"start",value:function(){var t=this,e=this.entryPoint.filters.UserOperationEvent(this.userOpHash);setTimeout((0,d.Z)((0,h.Z)().mark((function r(){var n;return(0,h.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.entryPoint.queryFilter(e,-10);case 2:(n=r.sent).length>0?t.listenerCallback(n[0]):t.entryPoint.once(e,t.boundLisener);case 4:case"end":return r.stop()}}),r)}))),100)}},{key:"stop",value:function(){this.entryPoint.off("UserOperationEvent",this.boundLisener)}},{key:"listenerCallback",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r,n,a,s,i,c=arguments;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=c.length,r=new Array(e),n=0;n<e;n++)r[n]=c[n];if((a=c[c.length-1]).args){t.next=5;break}return console.error("got event without args",a),t.abrupt("return");case 5:if(a.args.userOpHash===this.userOpHash){t.next=8;break}return console.log("== event with wrong userOpHash: sender/nonce: event.".concat(a.args.sender,"@").concat(a.args.nonce.toString(),"!= userOp.").concat(this.sender,"@").concat(parseInt(null===(s=this.nonce)||void 0===s?void 0:s.toString()))),t.abrupt("return");case 8:return t.next=10,a.getTransactionReceipt();case 10:if(i=t.sent,a.args.success){t.next=14;break}return t.next=14,this.extractFailureReason(i);case 14:this.stop(),this.resolve(i),this.resolved=!0;case 17:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"extractFailureReason",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.status=0,t.next=3,this.entryPoint.queryFilter(this.entryPoint.filters.UserOperationRevertReason(this.userOpHash,this.sender),e.blockHash);case 3:(r=t.sent)[0]&&((n=r[0].args.revertReason).startsWith("0x08c379a0")&&(n=y.$.decode(["string"],"0x"+n.substring(10)).toString()),this.reject(new Error("UserOp failed with reason: ".concat(n))));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),Y=function(t){(0,o.Z)(r,t);var e=(0,p.Z)(r);function r(t,n,a,s,i){var c;return(0,l.Z)(this,r),c=e.call(this),x.defineReadOnly((0,u.Z)(c),"provider",a),c.config=t,c.originalSigner=n,c.erc4337provider=a,c.httpRpcClient=s,c.smartAccountAPI=i,c.approving=!1,c}return(0,f.Z)(r,[{key:"sendTransaction",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a,s,i,c,u,o;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.approving){t.next=11;break}return this.approving=!0,t.next=4,this.smartAccountAPI.createApproveTx();case 4:if(!(a=t.sent)){t.next=10;break}return t.next=8,this.sendTransaction(a);case 8:return t.next=10,t.sent.wait();case 10:this.approving=!1;case 11:return t.next=13,x.resolveProperties(e);case 13:return s=t.sent,t.next=16,this.verifyAllNecessaryFields(s);case 16:return i=V(),t.next=19,this.smartAccountAPI.createUnsignedUserOp(this.httpRpcClient,{target:s.to||"",data:(null===(n=s.data)||void 0===n?void 0:n.toString())||"0x",value:s.value,gasLimit:s.gasLimit,nonce:i,maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas},r);case 19:return c=t.sent,t.next=22,this.smartAccountAPI.signUserOp(c);case 22:return u=t.sent,t.next=25,this.erc4337provider.constructUserOpTransactionResponse(u);case 25:return o=t.sent,t.prev=26,t.next=29,this.httpRpcClient.sendUserOpToBundler(u);case 29:t.next=34;break;case 31:throw t.prev=31,t.t0=t.catch(26),this.unwrapError(t.t0);case 34:return t.abrupt("return",o);case 35:case"end":return t.stop()}}),t,this,[[26,31]])})));return function(e,r){return t.apply(this,arguments)}}()},{key:"unwrapError",value:function(t){try{var e="Unknown Error";if(t.error)e="The bundler has failed to include UserOperation in a batch: ".concat(t.error);else if(t.body&&"string"===typeof t.body){var r,n,a,s=JSON.parse(t.body),i=t.status||"UNKNOWN",c=(null===s||void 0===s?void 0:s.code)||"UNKNOWN",u=(null===s||void 0===s||null===(r=s.error)||void 0===r?void 0:r.message)||(null===s||void 0===s||null===(n=s.error)||void 0===n?void 0:n.data)||(null===s||void 0===s?void 0:s.error)||t.reason;if(null!==(a=u)&&void 0!==a&&a.includes("FailedOp")){var o="",p=u.match(/FailedOp\((.*)\)/);if(p){var h=p[1].split(",");o="(paymaster address: ".concat(h[1],")"),u=h[2]}e="The bundler has failed to include UserOperation in a batch: ".concat(u," ").concat(o)}else e="RPC error: ".concat(u,"\nStatus: ").concat(i,"\nCode: ").concat(c)}var f=new Error(e);return f.stack=t.stack,f}catch(f){}return t}},{key:"verifyAllNecessaryFields",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.to){t.next=2;break}throw new Error("Missing call target");case 2:if(e.data||e.value){t.next=4;break}throw new Error("Missing call data or value");case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"connect",value:function(t){throw new Error("changing providers is not supported")}},{key:"getAddress",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.address){t.next=4;break}return t.next=3,this.erc4337provider.getSenderAccountAddress();case 3:this.address=t.sent;case 4:return t.abrupt("return",this.address);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"signMessage",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a,s,i,u,o,p,f,l,d,v,x,m;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.smartAccountAPI.checkAccountPhantom();case 2:if(!t.sent){t.next=15;break}return console.log("Account contract not deployed yet. Deploying account before signing message"),t.t0=this,t.next=8,this.getAddress();case 8:return t.t1=t.sent,t.t2={to:t.t1,data:"0x"},t.next=12,t.t0.sendTransaction.call(t.t0,t.t2);case 12:return r=t.sent,t.next=15,r.wait();case 15:return t.next=17,Promise.all([this.getChainId(),this.getAddress()]);case 17:return n=t.sent,a=(0,c.Z)(n,2),s=a[0],i=a[1],u=Z.r(e),f=(0,B.m)(s,this.config.clientId),l={},(0,U.i)(f)&&(d="undefined"!==typeof globalThis&&"APP_BUNDLE_ID"in globalThis?globalThis.APP_BUNDLE_ID:void 0,this.config.secretKey?l["x-secret-key"]=this.config.secretKey:this.config.clientId&&(l["x-client-id"]=this.config.clientId,d&&(l["x-bundle-id"]=d)),"undefined"!==typeof globalThis&&"TW_AUTH_TOKEN"in globalThis&&"string"===typeof globalThis.TW_AUTH_TOKEN&&(l.authorization="Bearer ".concat(globalThis.TW_AUTH_TOKEN)),"undefined"!==typeof globalThis&&"TW_CLI_AUTH_TOKEN"in globalThis&&"string"===typeof globalThis.TW_CLI_AUTH_TOKEN&&(l.authorization="Bearer ".concat(globalThis.TW_CLI_AUTH_TOKEN),l["x-authorize-wallet"]="true"),(0,E.s)(l)),t.prev=25,v=new k.c({url:f,headers:l},s),x=new b.CH(i,["function getMessageHash(bytes32 _hash) public view returns (bytes32)"],v),t.next=30,x.getMessageHash(u);case 30:o=!0,t.next=36;break;case 33:t.prev=33,t.t3=t.catch(25),o=!1;case 36:if(!o){t.next=43;break}return t.next=39,(0,F.aN)(this,{name:"Account",version:"1",chainId:s,verifyingContract:i},{AccountMessage:[{name:"message",type:"bytes"}]},{message:y.$.encode(["bytes32"],[u])});case 39:m=t.sent,p=m.signature,t.next=46;break;case 43:return t.next=45,this.originalSigner.signMessage(e);case 45:p=t.sent;case 46:return t.next=48,(0,L.c)(e,p,i,s,this.config.clientId,this.config.secretKey);case 48:if(!t.sent){t.next=53;break}return t.abrupt("return",p);case 53:throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.");case 54:case"end":return t.stop()}}),t,this,[[25,33]])})));return function(e){return t.apply(this,arguments)}}()},{key:"signTransaction",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a,s,i,c,u;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.resolveProperties(e);case 2:return a=t.sent,t.next=5,this.verifyAllNecessaryFields(a);case 5:return s=V(),t.next=8,this.smartAccountAPI.createUnsignedUserOp(this.httpRpcClient,{target:a.to||"",data:(null===(n=a.data)||void 0===n?void 0:n.toString())||"0x",value:a.value,gasLimit:a.gasLimit,nonce:s},r);case 8:return i=t.sent,t.next=11,this.smartAccountAPI.signUserOp(i);case 11:return c=t.sent,t.t0=JSON,t.next=15,R(c);case 15:return t.t1=t.sent,u=t.t0.stringify.call(t.t0,t.t1),t.abrupt("return",u);case 18:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()}]),r}(A.Signer),Q=function(t){(0,o.Z)(r,t);var e=(0,p.Z)(r);function r(t,n,a,s,i,c,o){var p;return(0,l.Z)(this,r),(p=e.call(this,{name:"ERC-4337 Custom Network",chainId:t})).chainId=t,p.config=n,p.originalSigner=a,p.originalProvider=s,p.httpRpcClient=i,p.entryPoint=c,p.smartAccountAPI=o,p.signer=new Y(n,a,(0,u.Z)(p),i,o),p}return(0,f.Z)(r,[{key:"getSigner",value:function(){return this.signer}},{key:"perform",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("sendTransaction"!==e&&"getTransactionReceipt"!==e){t.next=2;break}throw new Error("Should not get here. Investigate.");case 2:if("estimateGas"!==e){t.next=4;break}return t.abrupt("return",w.O$.from(5e5));case 4:return t.next=6,this.originalProvider.perform(e,r);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"getTransaction",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,s.Z)((0,i.Z)(r.prototype),"getTransaction",this).call(this,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getTransactionReceipt",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a=this;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:return r=t.sent,t.next=5,this.getSenderAccountAddress();case 5:return n=t.sent,t.next=8,new Promise((function(t,e){new q(t,e,a.entryPoint,n,r).start()}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSenderAccountAddress",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.smartAccountAPI.getAccountAddress();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"waitForTransaction",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r,n){var a,s=this;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSenderAccountAddress();case 2:return a=t.sent,t.next=5,new Promise((function(t,r){new q(t,r,s.entryPoint,a,e,void 0,n).start()}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"constructUserOpTransactionResponse",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a=this;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.resolveProperties(e);case 2:return r=t.sent,t.next=5,this.smartAccountAPI.getUserOpHash(r);case 5:return n=t.sent,t.abrupt("return",{hash:n,confirmations:0,from:r.sender,nonce:0,gasLimit:w.O$.from(r.callGasLimit),value:w.O$.from(0),data:m.hexValue(r.callData),chainId:this.chainId,wait:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.smartAccountAPI.getUserOpReceipt(a.httpRpcClient,n);case 2:if(s=t.sent,0===r.initCode.length){t.next=6;break}return t.next=6,a.smartAccountAPI.checkAccountPhantom();case 6:return t.abrupt("return",s);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()});case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"detectNetwork",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.originalProvider.detectNetwork());case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),r}(P.Zk);function X(t,e,r,n){var a=_.EntryPoint__factory.connect(t.entryPointAddress,r),s=new z(t.bundlerUrl,t.entryPointAddress,n,t.clientId,t.secretKey);return new Q(n,t,t.localSigner,r,s,a,e)}var tt=function(){function t(e){(0,l.Z)(this,t),(0,D._)(this,"isPhantom",!0),this.provider=e.provider,this.entryPointAddress=e.entryPointAddress,this.accountAddress=e.accountAddress,this.paymasterAPI=e.paymasterAPI,this.gasless=e.gasless,this.erc20PaymasterAddress=e.erc20PaymasterAddress,this.erc20TokenAddress=e.erc20TokenAddress,this.entryPointView=_.EntryPoint__factory.connect(e.entryPointAddress,e.provider).connect(T.d)}return(0,f.Z)(t,[{key:"checkAccountPhantom",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isPhantom){t.next=2;break}return t.abrupt("return",this.isPhantom);case 2:return t.next=4,this.provider.getCode(this.getAccountAddress());case 4:return t.sent.length>2&&(this.isPhantom=!1),t.abrupt("return",this.isPhantom);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getInitCode",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.checkAccountPhantom();case 2:if(!t.sent){t.next=6;break}return t.next=5,this.getAccountInitCode();case 5:return t.abrupt("return",t.sent);case 6:return t.abrupt("return","0x");case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getVerificationGasLimit",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",1e5);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getUserOpHash",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.provider.getNetwork().then((function(t){return t.chainId}));case 2:return r=t.sent,t.abrupt("return",$(e,this.entryPointAddress,r));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getAccountAddress",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.senderAddress){t.next=8;break}if(!this.accountAddress){t.next=5;break}this.senderAddress=this.accountAddress,t.next=8;break;case 5:return t.next=7,this.getCounterFactualAddress();case 7:this.senderAddress=t.sent;case 8:return t.abrupt("return",this.senderAddress);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"estimateCreationGas",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"0x"!==e){t.next=2;break}return t.abrupt("return",0);case 2:return r=e.substring(0,42),n="0x"+e.substring(42),t.next=6,this.provider.estimateGas({to:r,data:n});case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createUnsignedUserOp",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r,n){var s,i,u,o,p,f,l,v,x,m,g,y,k,Z,b,A,P,T,I,O,G,C,E,L,_=this;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.maxFeePerGas,u=r.maxPriorityFeePerGas,!(0,U.i)(e.bundlerUrl)){t.next=9;break}return t.next=4,e.getUserOperationGasPrice();case 4:o=t.sent,i=w.O$.from(o.maxFeePerGas),u=w.O$.from(o.maxPriorityFeePerGas),t.next=21;break;case 9:if(i&&u){t.next=21;break}return t.next=12,(0,N.a)(this.provider);case 12:if(p=t.sent,u||(u=null!==(f=p.maxPriorityFeePerGas)&&void 0!==f?f:void 0),i){t.next=21;break}return i=null!==(l=p.maxFeePerGas)&&void 0!==l?l:void 0,t.next=18,this.provider.getNetwork();case 18:v=t.sent,(x=v.chainId)!==K.Lll.chainId&&x!==K.M8s.chainId&&x!==K.m3x.chainId||(u=i);case 21:if(i&&u){t.next=23;break}throw new Error("maxFeePerGas or maxPriorityFeePerGas could not be calculated, please pass them explicitely");case 23:return t.next=25,Promise.all([this.getAccountAddress(),r.nonce?Promise.resolve(r.nonce):this.getNonce()]);case 25:return m=t.sent,g=(0,c.Z)(m,2),y=g[0],k=g[1],t.next=31,this.getInitCode();case 31:if(Z=t.sent,b=null!==(s=et(r.value))&&void 0!==s?s:w.O$.from(0),null===n||void 0===n||!n.batchData){t.next=37;break}t.t0=r.data,t.next=40;break;case 37:return t.next=39,this.prepareExecute(r.target,b,r.data).then(function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.gasLimit){t.next=3;break}return t.next=3,_.provider.estimateGas({from:y,to:r.target,data:r.data,value:b});case 3:return t.abrupt("return",e.encode());case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 39:t.t0=t.sent;case 40:if(A=t.t0,P={sender:y,nonce:k,initCode:Z,callData:A,maxFeePerGas:i,maxPriorityFeePerGas:u,callGasLimit:w.O$.from(1e6),verificationGasLimit:w.O$.from(1e6),preVerificationGas:w.O$.from(1e6),paymasterAndData:"0x",signature:"0xfffffffffffffffffffffffffffffff0000000000000000000000000000000007aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa1c"},T=void 0!==(null===n||void 0===n?void 0:n.gasless)?n.gasless:this.gasless,t.t1=this.erc20PaymasterAddress&&this.erc20TokenAddress,!t.t1){t.next=48;break}return t.next=47,this.isAccountApproved();case 47:t.t1=t.sent;case 48:if(!t.t1){t.next=65;break}return P.paymasterAndData=this.erc20PaymasterAddress,t.prev=51,t.next=54,e.estimateUserOpGas(P);case 54:I=t.sent,t.next=60;break;case 57:throw t.prev=57,t.t2=t.catch(51),this.unwrapBundlerError(t.t2);case 60:P.callGasLimit=I.callGasLimit,P.verificationGasLimit=I.verificationGasLimit,P.preVerificationGas=I.preVerificationGas,t.next=108;break;case 65:if(!T){t.next=96;break}return t.next=68,this.paymasterAPI.getPaymasterAndData(P);case 68:if(O=t.sent,(G=O.paymasterAndData)&&"0x"!==G&&(P.paymasterAndData=G),!(O.callGasLimit&&O.verificationGasLimit&&O.preVerificationGas)){t.next=77;break}P.callGasLimit=w.O$.from(O.callGasLimit),P.verificationGasLimit=w.O$.from(O.verificationGasLimit),P.preVerificationGas=w.O$.from(O.preVerificationGas),t.next=94;break;case 77:return t.prev=77,t.next=80,e.estimateUserOpGas(P);case 80:C=t.sent,t.next=86;break;case 83:throw t.prev=83,t.t3=t.catch(77),this.unwrapBundlerError(t.t3);case 86:if(P.callGasLimit=C.callGasLimit,P.verificationGasLimit=C.verificationGasLimit,P.preVerificationGas=C.preVerificationGas,!G||"0x"===G){t.next=94;break}return t.next=92,this.paymasterAPI.getPaymasterAndData(P);case 92:(E=t.sent).paymasterAndData&&"0x"!==E.paymasterAndData&&(P.paymasterAndData=E.paymasterAndData);case 94:t.next=108;break;case 96:return t.prev=96,t.next=99,e.estimateUserOpGas(P);case 99:L=t.sent,t.next=105;break;case 102:throw t.prev=102,t.t4=t.catch(96),this.unwrapBundlerError(t.t4);case 105:P.callGasLimit=L.callGasLimit,P.verificationGasLimit=L.verificationGasLimit,P.preVerificationGas=L.preVerificationGas;case 108:return t.abrupt("return",(0,a.Z)((0,a.Z)({},P),{},{signature:""}));case 109:case"end":return t.stop()}}),t,this,[[51,57],[77,83],[96,102]])})));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"signUserOp",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getUserOpHash(e);case 2:return r=t.sent,t.next=5,this.signUserOpHash(r);case 5:return n=t.sent,t.abrupt("return",(0,a.Z)((0,a.Z)({},e),{},{signature:n}));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getUserOpReceipt",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a,s,i,c=arguments;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=c.length>2&&void 0!==c[2]?c[2]:12e4,a=c.length>3&&void 0!==c[3]?c[3]:1e3,s=Date.now()+n;case 3:if(!(Date.now()<s)){t.next=15;break}return t.next=6,e.getUserOperationReceipt(r);case 6:if(!(i=t.sent)){t.next=11;break}return t.next=10,this.provider.waitForTransaction(i.receipt.transactionHash);case 10:return t.abrupt("return",t.sent);case 11:return t.next=13,new Promise((function(t){return setTimeout(t,a)}));case 13:t.next=3;break;case 15:throw new Error("Timeout waiting for userOp to be mined");case 16:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"unwrapBundlerError",value:function(t){var e,r=(null===t||void 0===t||null===(e=t.error)||void 0===e?void 0:e.message)||t.error||t.message||t;return new Error(r)}}]),t}();function et(t){return t&&""!==t?w.O$.from(t.toString()):null}var rt=function(t){(0,o.Z)(n,t);var e=(0,p.Z)(n);function n(t,r){var s;return(0,l.Z)(this,n),(s=e.call(this,(0,a.Z)((0,a.Z)({},t),{},{provider:r}))).params=t,s.sdk=S.T.fromPrivateKey(S.L,t.chain,{clientId:t.clientId,secretKey:t.secretKey,supportedChains:"object"===typeof t.chain?[t.chain]:void 0}),s}return(0,f.Z)(n,[{key:"getChainId",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.provider.getNetwork().then((function(t){return t.chainId}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAccountContract",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountContract){t.next=20;break}if(null===(e=this.params.accountInfo)||void 0===e||!e.abi){t.next=12;break}return t.t0=this.sdk,t.next=5,this.getAccountAddress();case 5:return t.t1=t.sent,t.t2=this.params.accountInfo.abi,t.next=9,t.t0.getContract.call(t.t0,t.t1,t.t2);case 9:this.accountContract=t.sent,t.next=20;break;case 12:return t.t3=this.sdk,t.next=15,this.getAccountAddress();case 15:return t.t4=t.sent,t.t5=L.A,t.next=19,t.t3.getContract.call(t.t3,t.t4,t.t5);case 19:this.accountContract=t.sent;case 20:return t.abrupt("return",this.accountContract);case 21:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAccountInitCode",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r,n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFactoryContract();case 2:return e=t.sent,t.next=5,this.params.localSigner.getAddress();case 5:return r=t.sent,t.next=8,this.params.factoryInfo.createAccount(e,r);case 8:return n=t.sent,t.abrupt("return",m.hexConcat([e.getAddress(),n.encode()]));case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getFactoryContract",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.factoryContract){t.next=2;break}return t.abrupt("return",this.factoryContract);case 2:if(null===(e=this.params.factoryInfo)||void 0===e||!e.abi){t.next=8;break}return t.next=5,this.sdk.getContract(this.params.factoryAddress,this.params.factoryInfo.abi);case 5:this.factoryContract=t.sent,t.next=11;break;case 8:return t.next=10,this.sdk.getContract(this.params.factoryAddress);case 10:this.factoryContract=t.sent;case 11:return t.abrupt("return",this.factoryContract);case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getCounterFactualAddress",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.params.accountAddress){t.next=2;break}return t.abrupt("return",this.params.accountAddress);case 2:return t.next=4,this.getFactoryContract();case 4:return e=t.sent,t.next=7,this.params.localSigner.getAddress();case 7:return r=t.sent,t.abrupt("return",this.params.factoryInfo.getAccountAddress(e,r));case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getNonce",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.checkAccountPhantom();case 2:if(!t.sent){t.next=4;break}return t.abrupt("return",w.O$.from(0));case 4:return t.next=6,this.getAccountContract();case 6:return e=t.sent,t.abrupt("return",this.params.accountInfo.getNonce(e));case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"prepareExecute",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r,n){var a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountContract();case 2:return a=t.sent,t.abrupt("return",this.params.accountInfo.execute(a,e,r,n));case 4:case"end":return t.stop()}}),t,this)})));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"prepareExecuteBatch",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r,n){var a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountContract();case 2:return a=t.sent,t.abrupt("return",a.prepare("executeBatch",[e,r,n]));case 4:case"end":return t.stop()}}),t,this)})));return function(e,r,n){return t.apply(this,arguments)}}()},{key:"signUserOpHash",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.params.localSigner.signMessage(m.arrayify(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"isAcountDeployed",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.checkAccountPhantom();case 2:return t.abrupt("return",!t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"isAccountApproved",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,n,a,s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.params.erc20PaymasterAddress&&this.params.erc20TokenAddress){t.next=2;break}return t.abrupt("return",!0);case 2:return t.next=4,this.getCounterFactualAddress();case 4:return e=t.sent,t.next=7,Promise.resolve().then(r.t.bind(r,49242,19));case 7:return n=t.sent.default,t.next=10,this.sdk.getContract(this.params.erc20TokenAddress,n);case 10:return a=t.sent,t.next=13,a.call("allowance",[e,this.params.erc20PaymasterAddress]);case 13:return s=t.sent,t.abrupt("return",s.gte(w.O$.from(2).pow(96).sub(1)));case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"createApproveTx",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r,n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.isAccountApproved();case 2:if(!t.sent){t.next=4;break}return t.abrupt("return",void 0);case 4:return e=w.O$.from(2).pow(96).sub(1),r=new I.Wallet(S.L,this.provider),n=new b.CH(this.params.erc20TokenAddress,["function approve(address spender, uint256 amount) public returns (bool)"],r),t.t0=this.params.erc20TokenAddress,t.next=10,this.getAccountAddress();case 10:return t.t1=t.sent,t.t2=n.interface.encodeFunctionData("approve",[this.params.erc20PaymasterAddress,e]),a={to:t.t0,from:t.t1,value:0,data:t.t2},t.abrupt("return",a);case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),n}(tt),nt=function(t){(0,o.Z)(r,t);var e=(0,p.Z)(r);function r(t){var n;return(0,l.Z)(this,r),(n=e.call(this)).config=t,n}return(0,f.Z)(r,[{key:"initialize",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a,s,i,c,u,o,p,f,l,d,v,x;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=this.config,o=(0,F.a$)(u.chain,{clientId:u.clientId,secretKey:u.secretKey}),t.next=4,o.getNetwork();case 4:return this.chainId=t.sent.chainId,p=this.config.bundlerUrl||"https://".concat(this.chainId,".bundler.thirdweb.com"),f=this.config.paymasterUrl||"https://".concat(this.chainId,".bundler.thirdweb.com"),l=u.entryPointAddress||L.E,t.next=10,e.personalWallet.getSigner();case 10:d=t.sent,v={chain:u.chain,localSigner:d,entryPointAddress:l,bundlerUrl:p,paymasterAPI:this.config.paymasterAPI?this.config.paymasterAPI:j(f,l,this.config.clientId,this.config.secretKey),gasless:u.gasless,factoryAddress:u.factoryAddress,accountAddress:e.accountAddress,factoryInfo:{createAccount:(null===(r=u.factoryInfo)||void 0===r?void 0:r.createAccount)||this.defaultFactoryInfo().createAccount,getAccountAddress:(null===(n=u.factoryInfo)||void 0===n?void 0:n.getAccountAddress)||this.defaultFactoryInfo().getAccountAddress,abi:null===(a=u.factoryInfo)||void 0===a?void 0:a.abi},accountInfo:{execute:(null===(s=u.accountInfo)||void 0===s?void 0:s.execute)||this.defaultAccountInfo().execute,getNonce:(null===(i=u.accountInfo)||void 0===i?void 0:i.getNonce)||this.defaultAccountInfo().getNonce,abi:null===(c=u.accountInfo)||void 0===c?void 0:c.abi},clientId:u.clientId,secretKey:u.secretKey,erc20PaymasterAddress:u.erc20PaymasterAddress,erc20TokenAddress:u.erc20TokenAddress},this.personalWallet=e.personalWallet,x=new rt(v,o),this.aaProvider=X(v,x,o,this.chainId),this.accountApi=x;case 16:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"connect",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.initialize(e);case 2:return t.next=4,this.getAddress();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getProvider",value:function(){if(!this.aaProvider)throw new Error("Personal wallet not connected");return Promise.resolve(this.aaProvider)}},{key:"getSigner",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.aaProvider){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.abrupt("return",Promise.resolve(this.aaProvider.getSigner()));case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAddress",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSigner();case 2:return e=t.sent,t.abrupt("return",e.getAddress());case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"isConnected",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getAddress();case 3:return e=t.sent,t.abrupt("return",!!e);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(){return t.apply(this,arguments)}}()},{key:"disconnect",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.personalWallet=void 0,this.aaProvider=void 0;case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"switchChain",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getProvider();case 2:return r=t.sent,t.next=5,r.getNetwork();case 5:if(t.sent.chainId===e){t.next=8;break}throw new Error("Not supported.");case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setupListeners",value:function(){return Promise.resolve()}},{key:"updateChains",value:function(t){}},{key:"hasPermissionToExecute",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a,s,i;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountContract();case 2:return n=t.sent,t.next=5,this.getSigner();case 5:return a=t.sent,t.next=8,a.getAddress();case 8:return s=t.sent,t.next=11,n.account.getAllSigners();case 11:if(t.t1=r=t.sent.filter((function(t){return O.getAddress(t.signer)===O.getAddress(s)}))[0],t.t0=null===t.t1,t.t0){t.next=15;break}t.t0=void 0===r;case 15:if(!t.t0){t.next=19;break}t.t2=void 0,t.next=20;break;case 19:t.t2=r.permissions;case 20:if(i=t.t2){t.next=23;break}return t.abrupt("return",!1);case 23:return t.abrupt("return",i.approvedCallTargets.includes(e.getTarget()));case 24:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"send",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSigner();case 2:return n=t.sent,t.t0=n,t.t1=e.getTarget(),t.t2=e.encode(),t.next=8,e.getValue();case 8:return t.t3=t.sent,t.t4={to:t.t1,data:t.t2,value:t.t3},t.t5=r,t.abrupt("return",t.t0.sendTransaction.call(t.t0,t.t4,t.t5));case 12:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"execute",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send(e,r);case 2:return n=t.sent,t.next=5,n.wait();case 5:return a=t.sent,t.abrupt("return",{receipt:a});case 7:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"sendBatch",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,s,i,c;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.getSigner();case 4:return n=t.sent,t.next=7,this.prepareBatchTx(e);case 7:return s=t.sent,i=s.tx,c=s.batchData,t.t0=n,t.next=13,n.getAddress();case 13:return t.t1=t.sent,t.t2=i.encode(),t.t3={to:t.t1,data:t.t2,value:0},t.t4=(0,a.Z)((0,a.Z)({},r),{},{batchData:c}),t.next=19,t.t0.sendTransaction.call(t.t0,t.t3,t.t4);case 19:return t.abrupt("return",t.sent);case 20:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"executeBatch",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendBatch(e,r);case 2:return n=t.sent,t.next=5,n.wait();case 5:return a=t.sent,t.abrupt("return",{receipt:a});case 7:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"sendRaw",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.getSigner();case 4:return n=t.sent,t.abrupt("return",n.sendTransaction(e,r));case 6:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"executeRaw",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRaw(e,r);case 2:return n=t.sent,t.next=5,n.wait();case 5:return a=t.sent,t.abrupt("return",{receipt:a});case 7:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"sendBatchRaw",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.getSigner();case 4:return n=t.sent,t.next=7,this.prepareBatchRaw(e);case 7:return s=t.sent,t.t0=n,t.next=11,n.getAddress();case 11:return t.t1=t.sent,t.t2=s.tx.encode(),t.t3={to:t.t1,data:t.t2,value:0},t.t4=(0,a.Z)((0,a.Z)({},r),{},{batchData:s.batchData}),t.abrupt("return",t.t0.sendTransaction.call(t.t0,t.t3,t.t4));case 16:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"executeBatchRaw",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendBatchRaw(e,r);case 2:return n=t.sent,t.next=5,n.wait();case 5:return a=t.sent,t.abrupt("return",{receipt:a});case 7:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"estimate",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.t0=this,t.t1=e.getTarget(),t.t2=e.encode(),t.next=7,e.getValue();case 7:return t.t3=t.sent,t.next=10,e.getOverrides().gasLimit;case 10:return t.t4=t.sent,t.next=13,e.getOverrides().maxFeePerGas;case 13:return t.t5=t.sent,t.next=16,e.getOverrides().maxPriorityFeePerGas;case 16:return t.t6=t.sent,t.next=19,e.getOverrides().nonce;case 19:return t.t7=t.sent,t.t8={target:t.t1,data:t.t2,value:t.t3,gasLimit:t.t4,maxFeePerGas:t.t5,maxPriorityFeePerGas:t.t6,nonce:t.t7},t.t9=r,t.abrupt("return",t.t0.estimateTx.call(t.t0,t.t8,t.t9));case 23:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"estimateRaw",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,x.resolveProperties(e);case 4:return a=t.sent,t.abrupt("return",this.estimateTx({target:a.to||T.d,data:(null===(n=a.data)||void 0===n?void 0:n.toString())||"",value:a.value||w.O$.from(0),gasLimit:a.gasLimit,maxFeePerGas:a.maxFeePerGas,maxPriorityFeePerGas:a.maxPriorityFeePerGas,nonce:a.nonce},r));case 6:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"estimateBatch",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,s,i;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.prepareBatchTx(e);case 4:return n=t.sent,s=n.tx,i=n.batchData,t.t0=this,t.t1=s.getTarget(),t.t2=s.encode(),t.next=12,s.getValue();case 12:return t.t3=t.sent,t.next=15,s.getOverrides().gasLimit;case 15:return t.t4=t.sent,t.next=18,s.getOverrides().maxFeePerGas;case 18:return t.t5=t.sent,t.next=21,s.getOverrides().maxPriorityFeePerGas;case 21:return t.t6=t.sent,t.next=24,s.getOverrides().nonce;case 24:return t.t7=t.sent,t.t8={target:t.t1,data:t.t2,value:t.t3,gasLimit:t.t4,maxFeePerGas:t.t5,maxPriorityFeePerGas:t.t6,nonce:t.t7},t.t9=(0,a.Z)((0,a.Z)({},r),{},{batchData:i}),t.abrupt("return",t.t0.estimateTx.call(t.t0,t.t8,t.t9));case 28:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"estimateBatchRaw",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,s,i;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.prepareBatchRaw(e);case 4:return n=t.sent,s=n.tx,i=n.batchData,t.t0=this,t.t1=s.getTarget(),t.t2=s.encode(),t.next=12,s.getValue();case 12:return t.t3=t.sent,t.next=15,s.getOverrides().gasLimit;case 15:return t.t4=t.sent,t.next=18,s.getOverrides().maxFeePerGas;case 18:return t.t5=t.sent,t.next=21,s.getOverrides().maxPriorityFeePerGas;case 21:return t.t6=t.sent,t.next=24,s.getOverrides().nonce;case 24:return t.t7=t.sent,t.t8={target:t.t1,data:t.t2,value:t.t3,gasLimit:t.t4,maxFeePerGas:t.t5,maxPriorityFeePerGas:t.t6,nonce:t.t7},t.t9=(0,a.Z)((0,a.Z)({},r),{},{batchData:i}),t.abrupt("return",t.t0.estimateTx.call(t.t0,t.t8,t.t9));case 28:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"deploy",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.getSigner();case 4:return r=t.sent,t.t0=r,t.next=8,r.getAddress();case 8:return t.t1=t.sent,t.t2={to:t.t1,data:"0x"},t.t3=(0,a.Z)((0,a.Z)({},e),{},{batchData:{targets:[],data:[],values:[]}}),t.next=13,t.t0.sendTransaction.call(t.t0,t.t2,t.t3);case 13:return n=t.sent,t.next=16,n.wait();case 16:return s=t.sent,t.abrupt("return",{receipt:s});case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"isDeployed",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.accountApi.isAcountDeployed();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"deployIfNeeded",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.isDeployed();case 2:if(t.sent){t.next=6;break}return t.next=6,this.deploy(e);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"grantPermissions",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountContract();case 2:return n=t.sent,t.abrupt("return",n.account.grantPermissions(e,r));case 4:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"revokePermissions",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountContract();case 2:return r=t.sent,t.abrupt("return",r.account.revokeAccess(e));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addAdmin",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountContract();case 2:return r=t.sent,t.abrupt("return",r.account.grantAdminPermissions(e));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"removeAdmin",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAccountContract();case 2:return r=t.sent,t.abrupt("return",r.account.revokeAdminPermissions(e));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getAllActiveSigners",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r,n;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.isDeployed();case 2:if(!t.sent){t.next=10;break}return t.next=6,this.getAccountContract();case 6:return e=t.sent,t.abrupt("return",e.account.getAllAdminsAndSigners());case 10:return t.next=12,null===(r=this.personalWallet)||void 0===r?void 0:r.getSigner();case 12:if(n=t.sent){t.next=15;break}throw new Error("Personal wallet not connected");case 15:return t.next=17,n.getAddress();case 17:return t.t0=t.sent,t.t1={startDate:new Date(0),expirationDate:new Date(0),nativeTokenLimitPerTransaction:w.O$.from(0),approvedCallTargets:[]},t.t2={isAdmin:!0,signer:t.t0,permissions:t.t1},t.abrupt("return",[t.t2]);case 21:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAccountContract",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=S.T,t.next=3,this.getSigner();case 3:if(t.t1=t.sent,t.t2=this.config.chain,t.t3={clientId:this.config.clientId,secretKey:this.config.secretKey},r=t.t0.fromSigner.call(t.t0,t.t1,t.t2,t.t3),null===(e=this.config.accountInfo)||void 0===e||!e.abi){t.next=16;break}return t.t4=r,t.next=11,this.getAddress();case 11:return t.t5=t.sent,t.t6=this.config.accountInfo.abi,t.abrupt("return",t.t4.getContract.call(t.t4,t.t5,t.t6));case 16:return t.t7=r,t.next=19,this.getAddress();case 19:return t.t8=t.sent,t.t9=L.A,t.abrupt("return",t.t7.getContract.call(t.t7,t.t8,t.t9));case 22:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getFactoryContract",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=S.T,t.next=3,this.getSigner();case 3:if(t.t1=t.sent,t.t2=this.config.chain,t.t3={clientId:this.config.clientId,secretKey:this.config.secretKey},r=t.t0.fromSigner.call(t.t0,t.t1,t.t2,t.t3),null===(e=this.config.factoryInfo)||void 0===e||!e.abi){t.next=9;break}return t.abrupt("return",r.getContract(this.config.factoryAddress,this.config.factoryInfo.abi));case 9:return t.abrupt("return",r.getContract(this.config.factoryAddress));case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"defaultFactoryInfo",value:function(){return{createAccount:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.prepare("createAccount",[r,G.Y0("")]));case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),getAccountAddress:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.call("getAddress",[r,G.Y0("")]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}}},{key:"defaultAccountInfo",value:function(){return{execute:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r,n,a){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.prepare("execute",[r,n,a]));case 1:case"end":return t.stop()}}),t)})));return function(e,r,n,a){return t.apply(this,arguments)}}(),getNonce:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.call("getNonce",[]));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}},{key:"estimateTx",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e,r){var n,a,s,i,u,o,p,f,l,d,v,m,g;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi&&this.aaProvider){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return n=w.O$.from(0),t.next=5,Promise.all([this.getProvider(),this.isDeployed()]);case 5:if(a=t.sent,s=(0,c.Z)(a,2),i=s[0],s[1]){t.next=13;break}return t.next=12,this.estimateDeploymentGasLimit();case 12:n=t.sent;case 13:return t.next=15,Promise.all([this.accountApi.createUnsignedUserOp(this.aaProvider.httpRpcClient,e,r),(0,N.b)(i)]);case 15:return u=t.sent,o=(0,c.Z)(u,2),p=o[0],f=o[1],t.next=21,x.resolveProperties(p);case 21:return l=t.sent,d=w.O$.from(l.callGasLimit),v=d.mul(f),m=n.mul(f),g=m.add(v),t.abrupt("return",{ether:C.formatEther(g),wei:g,details:{deployGasLimit:n,transactionGasLimit:d,gasPrice:f,transactionCost:v,deployCost:m,totalCost:g}});case 27:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"estimateDeploymentGasLimit",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(){var e,r,n,a,s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,this.accountApi.getInitCode();case 4:return e=t.sent,t.next=7,Promise.all([this.accountApi.estimateCreationGas(e),this.accountApi.getVerificationGasLimit()]);case 7:return r=t.sent,n=(0,c.Z)(r,2),a=n[0],s=n[1],t.abrupt("return",w.O$.from(s).add(a));case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"prepareBatchRaw",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a,s;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return t.next=4,Promise.all(e.map((function(t){return x.resolveProperties(t)})));case 4:return r=t.sent,n=r.map((function(t){return t.to||T.d})),a=r.map((function(t){return t.data||"0x"})),s=r.map((function(t){return t.value||w.O$.from(0)})),t.next=10,this.accountApi.prepareExecuteBatch(n,s,a);case 10:return t.t0=t.sent,t.t1={targets:n,data:a,values:s},t.abrupt("return",{tx:t.t0,batchData:t.t1});case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"prepareBatchTx",value:function(){var t=(0,d.Z)((0,h.Z)().mark((function t(e){var r,n,a;return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.accountApi){t.next=2;break}throw new Error("Personal wallet not connected");case 2:return r=e.map((function(t){return t.getTarget()})),n=e.map((function(t){return t.encode()})),t.next=6,Promise.all(e.map((function(t){return t.getValue()})));case 6:return a=t.sent,t.next=9,this.accountApi.prepareExecuteBatch(r,a,n);case 9:return t.t0=t.sent,t.t1={targets:r,data:n,values:a},t.abrupt("return",{tx:t.t0,batchData:t.t1});case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),r}(v.C)}}]);
//# sourceMappingURL=105.c3461728.chunk.js.map