"use strict";(self.webpackChunkgeoblocs=self.webpackChunkgeoblocs||[]).push([[7019],{15856:function(t,r,e){e.d(r,{c:function(){return s}});var n=e(68365),a=e(31714);function s(t){return(0,a.i)(t)?n.aV:t}},84969:function(t,r,e){e.d(r,{C:function(){return d}});var n=e(29439),a=e(74165),s=e(15861),c=e(15671),o=e(43144),i=e(4942),u=e(36980),p=e(68365),d=function(){function t(r){var e=this;(0,c.Z)(this,t),(0,i.Z)(this,"featureName",p.dq.name),(0,i.Z)(this,"set",(0,u.d)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.bF.parseAsync(r);case 2:return n=t.sent,t.abrupt("return",u.T.fromContractWrapper({contractWrapper:e.contractWrapper,method:"setPlatformFeeInfo",args:[n.platform_fee_recipient,n.platform_fee_basis_points]}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r}return(0,o.Z)(t,[{key:"get",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var r,e,s,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("getPlatformFeeInfo",[]);case 2:return r=t.sent,e=(0,n.Z)(r,2),s=e[0],c=e[1],t.abrupt("return",p.bF.parseAsync({platform_fee_recipient:s,platform_fee_basis_points:c}));case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}()},27161:function(t,r,e){e.d(r,{a:function(){return k},g:function(){return b},h:function(){return v},i:function(){return f},m:function(){return g},v:function(){return h}});var n=e(74165),a=e(29439),s=e(15861),c=e(34029),o=e(2257),i=e(44554),u=e(80391),p=e(68365),d=e(31714);function f(t,r,e,n,a){return l.apply(this,arguments)}function l(){return(l=(0,s.Z)((0,n.Z)().mark((function t(r,s,o,i,p){var d,f,l,v,m,h,g,x,k,b,w,y;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.e(5025).then(e.t.bind(e,25025,19));case 3:return d=t.sent.default,f=new c.CH(o,d,r),t.next=7,Promise.all([f.supportsInterface(u.I),f.supportsInterface(u.a)]);case 7:if(l=t.sent,v=(0,a.Z)(l,2),m=v[0],h=v[1],!m){t.next=32;break}return t.next=14,Promise.resolve().then(e.t.bind(e,70332,19));case 14:return x=t.sent.default,k=new c.CH(o,x,r),t.next=18,k.isApprovedForAll(p,s);case 18:if(!t.sent){t.next=21;break}return t.abrupt("return",!0);case 21:return t.prev=21,t.next=24,k.getApproved(i);case 24:b=t.sent,t.next=29;break;case 27:t.prev=27,t.t0=t.catch(21);case 29:return t.abrupt("return",(null===(g=b)||void 0===g?void 0:g.toLowerCase())===s.toLowerCase());case 32:if(!h){t.next=42;break}return t.next=35,Promise.resolve().then(e.t.bind(e,8455,19));case 35:return w=t.sent.default,y=new c.CH(o,w,r),t.next=39,y.isApprovedForAll(p,s);case 39:return t.abrupt("return",t.sent);case 42:return console.error("Contract does not implement ERC 1155 or ERC 721."),t.abrupt("return",!1);case 44:t.next=50;break;case 46:return t.prev=46,t.t1=t.catch(0),console.error("Failed to check if token is approved",t.t1),t.abrupt("return",!1);case 50:case"end":return t.stop()}}),t,null,[[0,46],[21,27]])})))).apply(this,arguments)}function v(t,r,e,n,a){return m.apply(this,arguments)}function m(){return(m=(0,s.Z)((0,n.Z)().mark((function t(r,s,c,o,i){var d,f,l,v,m,h,g,x,k,b;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.e(5025).then(e.t.bind(e,25025,19));case 2:return d=t.sent.default,f=new p.cq(r.getSignerOrProvider(),c,d,r.options,r.storage),t.next=6,Promise.all([f.read("supportsInterface",[u.I]),f.read("supportsInterface",[u.a])]);case 6:if(l=t.sent,v=(0,a.Z)(l,2),m=v[0],h=v[1],!m){t.next=29;break}return t.next=13,Promise.resolve().then(e.t.bind(e,70332,19));case 13:return g=t.sent.default,x=new p.cq(r.getSignerOrProvider(),c,g,r.options,r.storage),t.next=17,x.read("isApprovedForAll",[i,s]);case 17:if(t.sent){t.next=27;break}return t.next=21,x.read("getApproved",[o]);case 21:if(t.t0=t.sent.toLowerCase(),t.t1=s.toLowerCase(),t.t0===t.t1){t.next=27;break}return t.next=27,x.sendTransaction("setApprovalForAll",[s,!0]);case 27:case 40:t.next=43;break;case 29:if(!h){t.next=42;break}return t.next=32,Promise.resolve().then(e.t.bind(e,8455,19));case 32:return k=t.sent.default,b=new p.cq(r.getSignerOrProvider(),c,k,r.options,r.storage),t.next=36,b.read("isApprovedForAll",[i,s]);case 36:if(t.sent){t.next=40;break}return t.next=40,b.sendTransaction("setApprovalForAll",[s,!0]);case 42:throw Error("Contract must implement ERC 1155 or ERC 721.");case 43:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){if((0,i.Z)(void 0!==t.assetContractAddress&&null!==t.assetContractAddress,"Asset contract address is required"),(0,i.Z)(void 0!==t.buyoutPricePerToken&&null!==t.buyoutPricePerToken,"Buyout price is required"),(0,i.Z)(void 0!==t.listingDurationInSeconds&&null!==t.listingDurationInSeconds,"Listing duration is required"),(0,i.Z)(void 0!==t.startTimestamp&&null!==t.startTimestamp,"Start time is required"),(0,i.Z)(void 0!==t.tokenId&&null!==t.tokenId,"Token ID is required"),(0,i.Z)(void 0!==t.quantity&&null!==t.quantity,"Quantity is required"),"NewAuctionListing"===t.type)(0,i.Z)(void 0!==t.reservePricePerToken&&null!==t.reservePricePerToken,"Reserve price is required")}function g(t,r,e){return x.apply(this,arguments)}function x(){return(x=(0,s.Z)((0,n.Z)().mark((function t(r,e,a){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a.quantityDesired,t.t1=a.pricePerToken,t.t2=a.currency,t.t3=a.offeror,t.t4=a.quantityWanted,t.next=7,(0,d.a)(r,a.currency,a.quantityWanted.mul(a.pricePerToken));case 7:return t.t5=t.sent,t.t6=e,t.abrupt("return",{quantity:t.t0,pricePerToken:t.t1,currencyContractAddress:t.t2,buyerAddress:t.t3,quantityDesired:t.t4,currencyValue:t.t5,listingId:t.t6});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t,r,e){return e=o.O$.from(e),t=o.O$.from(t),r=o.O$.from(r),!t.eq(o.O$.from(0))&&r.sub(t).mul(p.dA).div(t).gte(e)}function b(t,r,e){return w.apply(this,arguments)}function w(){return(w=(0,s.Z)((0,n.Z)().mark((function t(r,e,a){var s;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(s=[];e-r>u.D;)s.push(a(r,r+u.D-1)),r+=u.D;return s.push(a(r,e-1)),t.next=5,Promise.all(s);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},2260:function(t,r,e){e.d(r,{M:function(){return O},a:function(){return P},b:function(){return S}});var n=e(29439),a=e(93433),s=e(74165),c=e(15861),o=e(15671),i=e(43144),u=e(4942),p=e(2257),d=e(34029),f=e(6222),l=e(68624),v=e(44554),m=e(15856),h=e(31714),g=e(46413),x=e(75580),k=e(68365),b=e(27161),w=e(80391),y=e(36980),Z=e(22105),A=e(60874),C=e(31109),W=e(72106),T=function(){return A.z.object({assetContractAddress:k.b9,tokenId:k.b6,quantity:k.b6.default(1),currencyContractAddress:k.b9.default(k.aV),pricePerToken:k.cv,startTimestamp:Z.R.default(new Date),endTimestamp:Z.E,isReservedListing:A.z.boolean().default(!1)})}(),L=function(t){return t[t.UNSET=0]="UNSET",t[t.Created=1]="Created",t[t.Completed=2]="Completed",t[t.Cancelled=3]="Cancelled",t[t.Active=4]="Active",t[t.Expired=5]="Expired",t}({}),O=function(){function t(r,e){var n=this;(0,o.Z)(this,t),(0,u.Z)(this,"featureName",k.dw.name),(0,u.Z)(this,"createListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,a,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T.parseAsync(r);case 2:return e=t.sent,t.t0=b.h,t.t1=n.contractWrapper,t.t2=n.getAddress(),t.t3=e.assetContractAddress,t.t4=e.tokenId,t.next=10,n.contractWrapper.getSignerAddress();case 10:return t.t5=t.sent,t.next=13,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 13:return t.next=15,(0,g.n)(n.contractWrapper.getProvider(),e.pricePerToken,e.currencyContractAddress);case 15:return a=t.sent,t.next=18,n.contractWrapper.getProvider().getBlock("latest");case 18:return c=t.sent,o=c.timestamp,e.startTimestamp.lt(o)&&(e.startTimestamp=p.O$.from(o)),t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"createListing",args:[{assetContract:e.assetContractAddress,tokenId:e.tokenId,quantity:e.quantity,currency:(0,m.c)(e.currencyContractAddress),pricePerToken:a,startTimestamp:e.startTimestamp,endTimestamp:e.endTimestamp,reserved:e.isReservedListing}],parse:function(t){return{id:n.contractWrapper.parseLogs("NewListing",null===t||void 0===t?void 0:t.logs)[0].args.listingId,receipt:t}}}));case 22:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"createListingsBatch",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map((function(t){return n.createListing.prepare(t)})));case 2:return e=t.sent.map((function(t){return t.encode()})),t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[e],parse:function(t){return n.contractWrapper.parseLogs("NewListing",null===t||void 0===t?void 0:t.logs).map((function(r){return{id:r.args.listingId,receipt:t}}))}}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"updateListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var a,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T.parseAsync(e);case 2:return a=t.sent,t.t0=b.h,t.t1=n.contractWrapper,t.t2=n.getAddress(),t.t3=a.assetContractAddress,t.t4=a.tokenId,t.next=10,n.contractWrapper.getSignerAddress();case 10:return t.t5=t.sent,t.next=13,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 13:return t.next=15,(0,g.n)(n.contractWrapper.getProvider(),a.pricePerToken,a.currencyContractAddress);case 15:return c=t.sent,t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"updateListing",args:[r,{assetContract:a.assetContractAddress,tokenId:a.tokenId,quantity:a.quantity,currency:(0,m.c)(a.currencyContractAddress),pricePerToken:c,startTimestamp:a.startTimestamp,endTimestamp:a.endTimestamp,reserved:a.isReservedListing}],parse:function(t){return{id:n.contractWrapper.parseLogs("UpdatedListing",null===t||void 0===t?void 0:t.logs)[0].args.listingId,receipt:t}}}));case 17:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"cancelListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"cancelListing",args:[r]}));case 1:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"buyFromListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e,a){var c,o,i,u,d,f,l,v;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=4;break}return t.next=3,(0,k.aL)(a);case 3:a=t.sent;case 4:return t.next=6,n.validateListing(p.O$.from(r));case 6:return c=t.sent,t.next=9,n.isStillValidListing(c,e);case 9:if(o=t.sent,i=o.valid,u=o.error,i){t.next=14;break}throw new Error("Listing ".concat(r," is no longer valid. ").concat(u));case 14:if(!a){t.next=18;break}t.t0=a,t.next=21;break;case 18:return t.next=20,n.contractWrapper.getSignerAddress();case 20:t.t0=t.sent;case 21:return d=t.t0,f=p.O$.from(e),l=p.O$.from(c.pricePerToken).mul(f),t.next=26,n.contractWrapper.getCallOverrides();case 26:if(t.t1=t.sent,t.t1){t.next=29;break}t.t1={};case 29:return v=t.t1,t.next=32,(0,x.s)(n.contractWrapper,l,c.currencyContractAddress,v);case 32:return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"buyFromListing",args:[r,d,f,c.currencyContractAddress,l],overrides:v}));case 33:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,u.Z)(this,"approveBuyerForReservedListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.isBuyerApprovedForListing(r,e);case 2:if(t.sent){t.next=7;break}return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"approveBuyerForListing",args:[r,e,!0]}));case 7:throw new Error("Buyer ".concat(e," already approved for listing ").concat(r,"."));case 8:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"revokeBuyerApprovalForReservedListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.isBuyerApprovedForListing(r,e);case 2:if(!t.sent){t.next=7;break}return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"approveBuyerForListing",args:[r,e,!1]}));case 7:throw new Error("Buyer ".concat(e," not approved for listing ").concat(r,"."));case 8:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"approveCurrencyForListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e,a){var c,o,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return c=t.sent,t.next=5,(0,k.aL)(e);case 5:return(o=t.sent)===c.currencyContractAddress&&(0,v.Z)(a===c.pricePerToken,"Approving listing currency with a different price."),t.next=9,n.contractWrapper.read("currencyPriceForListing",[r,o]);case 9:return i=t.sent,(0,v.Z)(a===i,"Currency already approved with this price."),t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"approveCurrencyForListing",args:[r,o,a]}));case 12:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,u.Z)(this,"revokeCurrencyApprovalForListing",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var a,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return a=t.sent,t.next=5,(0,k.aL)(e);case 5:if((c=t.sent)!==a.currencyContractAddress){t.next=8;break}throw new Error("Can't revoke approval for main listing currency.");case 8:return t.next=10,n.contractWrapper.read("currencyPriceForListing",[r,c]);case 10:return o=t.sent,(0,v.Z)(!o.isZero(),"Currency not approved."),t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"approveCurrencyForListing",args:[r,c,p.O$.from(0)]}));case 13:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),this.contractWrapper=r,this.storage=e,this.events=new C.a(this.contractWrapper),this.encoder=new h.C(this.contractWrapper),this.interceptor=new W.C(this.contractWrapper),this.estimator=new C.G(this.contractWrapper)}return(0,i.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getTotalCount",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("totalListings",[]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAll",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a,c,o,i,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=p.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No listings exist on the contract.");case 7:return c=[],t.next=10,(0,b.g)(n,a,(function(t,r){return u.contractWrapper.read("getAllListings",[t,r])}));case 10:return o=t.sent,c=o.flat(),t.next=14,this.applyFilter(c,r);case 14:return i=t.sent,t.next=17,Promise.all(i.map((function(t){return u.mapListing(t)})));case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllValid",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a,c,o,i,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=p.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No listings exist on the contract.");case 7:return c=[],t.next=10,(0,b.g)(n,a,(function(t,r){return u.contractWrapper.read("getAllValidListings",[t,r])}));case 10:return o=t.sent,c=o.flat(),t.next=14,this.applyFilter(c,r);case 14:return i=t.sent,t.next=17,Promise.all(i.map((function(t){return u.mapListing(t)})));case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getListing",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("getListing",[r]);case 2:return e=t.sent,t.next=5,this.mapListing(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isBuyerApprovedForListing",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(p.O$.from(r));case 2:if(t.sent.isReservedListing){t.next=5;break}throw new Error("Listing ".concat(r," is not a reserved listing."));case 5:return t.t0=this.contractWrapper,t.t1=r,t.next=9,(0,k.aL)(e);case 9:return t.t2=t.sent,t.t3=[t.t1,t.t2],t.next=13,t.t0.read.call(t.t0,"isBuyerApprovedForListing",t.t3);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"isCurrencyApprovedForListing",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(p.O$.from(r));case 2:return t.t0=this.contractWrapper,t.t1=r,t.next=6,(0,k.aL)(e);case 6:return t.t2=t.sent,t.t3=[t.t1,t.t2],t.next=10,t.t0.read.call(t.t0,"isCurrencyApprovedForListing",t.t3);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"currencyPriceForListing",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(p.O$.from(r));case 2:return n=t.sent,t.next=5,(0,k.aL)(e);case 5:if((a=t.sent)!==n.currencyContractAddress){t.next=8;break}return t.abrupt("return",n.pricePerToken);case 8:return t.next=10,this.isCurrencyApprovedForListing(r,a);case 10:if(t.sent){t.next=13;break}throw new Error("Currency ".concat(a," is not approved for Listing ").concat(r,"."));case 13:return t.next=15,this.contractWrapper.read("currencyPriceForListing",[r,a]);case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"validateListing",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getListing(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the listing with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapListing",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=L.UNSET,t.next=3,this.contractWrapper.getProvider().getBlock("latest");case 3:n=t.sent,a=n.timestamp,t.t0=r.status,t.next=1===t.t0?8:2===t.t0?10:3===t.t0?12:14;break;case 8:return e=p.O$.from(r.startTimestamp).gt(a)?L.Created:p.O$.from(r.endTimestamp).lt(a)?L.Expired:L.Active,t.abrupt("break",14);case 10:return e=L.Completed,t.abrupt("break",14);case 12:return e=L.Cancelled,t.abrupt("break",14);case 14:return t.t1=r.assetContract,t.t2=r.currency,t.t3=r.pricePerToken.toString(),t.next=19,(0,h.a)(this.contractWrapper.getProvider(),r.currency,r.pricePerToken);case 19:return t.t4=t.sent,t.t5=r.listingId.toString(),t.t6=r.tokenId.toString(),t.t7=r.quantity.toString(),t.t8=p.O$.from(r.startTimestamp).toNumber(),t.next=26,(0,w.c)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 26:return t.t9=t.sent,t.t10=p.O$.from(r.endTimestamp).toNumber(),t.t11=r.listingCreator,t.t12=r.reserved,t.t13=e,t.abrupt("return",{assetContractAddress:t.t1,currencyContractAddress:t.t2,pricePerToken:t.t3,currencyValuePerToken:t.t4,id:t.t5,tokenId:t.t6,quantity:t.t7,startTimeInSeconds:t.t8,asset:t.t9,endTimeInSeconds:t.t10,creatorAddress:t.t11,isReservedListing:t.t12,status:t.t13});case 32:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isStillValidListing",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,n){var a,c,o,i,u,p,f,l,v,m,h,g,x,k;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,b.i)(this.contractWrapper.getProvider(),this.getAddress(),r.assetContractAddress,r.tokenId,r.creatorAddress);case 2:if(t.sent){t.next=5;break}return t.abrupt("return",{valid:!1,error:"Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress,"' is not approved for transfer")});case 5:return a=this.contractWrapper.getProvider(),t.next=8,e.e(5025).then(e.t.bind(e,25025,19));case 8:return c=t.sent.default,o=new d.CH(r.assetContractAddress,c,a),t.next=12,o.supportsInterface(w.I);case 12:return i=t.sent,t.next=15,o.supportsInterface(w.a);case 15:if(u=t.sent,!i){t.next=33;break}return t.next=19,Promise.resolve().then(e.t.bind(e,70332,19));case 19:return f=t.sent.default,l=new d.CH(r.assetContractAddress,f,a),t.prev=21,t.next=24,l.ownerOf(r.tokenId);case 24:v=t.sent,t.next=29;break;case 27:t.prev=27,t.t0=t.catch(21);case 29:return m=(null===(p=v)||void 0===p?void 0:p.toLowerCase())===r.creatorAddress.toLowerCase(),t.abrupt("return",{valid:m,error:m?void 0:"Seller is not the owner of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," anymore'")});case 33:if(!u){t.next=45;break}return t.next=36,Promise.resolve().then(e.t.bind(e,8455,19));case 36:return h=t.sent.default,g=new d.CH(r.assetContractAddress,h,a),t.next=40,g.balanceOf(r.creatorAddress,r.tokenId);case 40:return x=t.sent,k=x.gte(n||r.quantity),t.abrupt("return",{valid:k,error:k?void 0:"Seller does not have enough balance of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," to fulfill the listing")});case 45:return t.abrupt("return",{valid:!1,error:"Contract does not implement ERC 1155 or ERC 721."});case 46:case"end":return t.stop()}}),t,this,[[21,27]])})));return function(r,e){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var n,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(0,a.Z)(r),!e){t.next=13;break}if(!e.seller){t.next=7;break}return t.next=5,(0,k.aL)(e.seller);case 5:c=t.sent,n=n.filter((function(t){return t.listingCreator.toString().toLowerCase()===(null===c||void 0===c?void 0:c.toString().toLowerCase())}));case 7:if(!e.tokenContract){t.next=12;break}return t.next=10,(0,k.aL)(e.tokenContract);case 10:o=t.sent,n=n.filter((function(t){return t.assetContract.toString().toLowerCase()===(null===o||void 0===o?void 0:o.toString().toLowerCase())}));case 12:void 0!==e.tokenId&&(n=n.filter((function(t){var r;return t.tokenId.toString()===(null===e||void 0===e||null===(r=e.tokenId)||void 0===r?void 0:r.toString())})));case 13:return t.abrupt("return",null!==e&&void 0!==e&&e.count&&e.count<n.length?n.slice(0,e.count):n);case 14:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}()}]),t}(),I=function(){return A.z.object({assetContractAddress:k.b9,tokenId:k.b6,quantity:k.b6.default(1),currencyContractAddress:k.b9.default(k.aV),minimumBidAmount:k.cv,buyoutBidAmount:k.cv,timeBufferInSeconds:k.b6.default(900),bidBufferBps:k.b6.default(500),startTimestamp:Z.R.default(new Date),endTimestamp:Z.E})}(),P=function(){function t(r,e){var n=this;(0,o.Z)(this,t),(0,u.Z)(this,"featureName",k.dx.name),(0,u.Z)(this,"createAuction",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,a,c,o,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=I.parse(r),t.t0=b.h,t.t1=n.contractWrapper,t.t2=n.getAddress(),t.t3=e.assetContractAddress,t.t4=e.tokenId,t.next=8,n.contractWrapper.getSignerAddress();case 8:return t.t5=t.sent,t.next=11,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 11:return t.next=13,(0,g.n)(n.contractWrapper.getProvider(),e.buyoutBidAmount,e.currencyContractAddress);case 13:return a=t.sent,t.next=16,(0,g.n)(n.contractWrapper.getProvider(),e.minimumBidAmount,e.currencyContractAddress);case 16:return c=t.sent,t.next=19,n.contractWrapper.getProvider().getBlock("latest");case 19:return o=t.sent,i=o.timestamp,e.startTimestamp.lt(i)&&(e.startTimestamp=p.O$.from(i)),t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"createAuction",args:[{assetContract:e.assetContractAddress,tokenId:e.tokenId,quantity:e.quantity,currency:(0,m.c)(e.currencyContractAddress),minimumBidAmount:c,buyoutBidAmount:a,timeBufferInSeconds:e.timeBufferInSeconds,bidBufferBps:e.bidBufferBps,startTimestamp:e.startTimestamp,endTimestamp:e.endTimestamp}],parse:function(t){return{id:n.contractWrapper.parseLogs("NewAuction",t.logs)[0].args.auctionId,receipt:t}}}));case 23:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"createAuctionsBatch",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map((function(t){return n.createAuction.prepare(t)})));case 2:return e=t.sent.map((function(t){return t.encode()})),t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[e],parse:function(t){return n.contractWrapper.parseLogs("NewAuction",null===t||void 0===t?void 0:t.logs).map((function(r){return{id:r.args.auctionId,receipt:t}}))}}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"buyoutAuction",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateAuction(p.O$.from(r));case 2:return e=t.sent,t.next=5,(0,h.f)(n.contractWrapper.getProvider(),e.currencyContractAddress);case 5:return a=t.sent,t.abrupt("return",n.makeBid.prepare(r,f.formatUnits(e.buyoutBidAmount,a.decimals)));case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"makeBid",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var a,c,o,i,u,d;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateAuction(p.O$.from(r));case 2:return a=t.sent,t.next=5,(0,g.n)(n.contractWrapper.getProvider(),e,a.currencyContractAddress);case 5:if(!(c=t.sent).eq(p.O$.from(0))){t.next=8;break}throw new Error("Cannot make a bid with 0 value");case 8:if(!p.O$.from(a.buyoutBidAmount).gt(0)||!c.gt(a.buyoutBidAmount)){t.next=10;break}throw new Error("Bid amount must be less than or equal to buyoutBidAmount");case 10:return t.next=12,n.getWinningBid(r);case 12:if(!t.sent){t.next=20;break}return t.next=16,n.isWinningBid(r,c);case 16:o=t.sent,(0,v.Z)(o,"Bid price is too low based on the current winning bid and the bid buffer"),t.next=23;break;case 20:i=c,u=p.O$.from(a.minimumBidAmount),(0,v.Z)(i.gte(u),"Bid price is too low based on minimum bid amount");case 23:return t.next=25,n.contractWrapper.getCallOverrides();case 25:if(t.t0=t.sent,t.t0){t.next=28;break}t.t0={};case 28:return d=t.t0,t.next=31,(0,x.s)(n.contractWrapper,c,a.currencyContractAddress,d);case 31:return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"bidInAuction",args:[r,c],overrides:d}));case 32:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"cancelAuction",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getWinningBid(r);case 2:if(!t.sent){t.next=5;break}throw new Error("Bids already made.");case 5:return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"cancelAuction",args:[r]}));case 6:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"closeAuctionForBidder",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=4;break}return t.next=3,n.contractWrapper.getSignerAddress();case 3:e=t.sent;case 4:return t.next=6,n.validateAuction(p.O$.from(r));case 6:return a=t.sent,t.prev=7,t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"collectAuctionTokens",args:[p.O$.from(r)]}));case 11:if(t.prev=11,t.t0=t.catch(7),!t.t0.message.includes("Marketplace: auction still active.")){t.next=17;break}throw new k.w(r.toString(),a.endTimeInSeconds.toString());case 17:throw t.t0;case 18:case"end":return t.stop()}}),t,null,[[7,11]])})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"closeAuctionForSeller",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateAuction(p.O$.from(r));case 2:return e=t.sent,t.prev=3,t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"collectAuctionPayout",args:[p.O$.from(r)]}));case 7:if(t.prev=7,t.t0=t.catch(3),!t.t0.message.includes("Marketplace: auction still active.")){t.next=13;break}throw new k.w(r.toString(),e.endTimeInSeconds.toString());case 13:throw t.t0;case 14:case"end":return t.stop()}}),t,null,[[3,7]])})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"executeSale",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,a,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateAuction(p.O$.from(r));case 2:return e=t.sent,t.prev=3,t.next=6,n.getWinningBid(r);case 6:return a=t.sent,(0,v.Z)(a,"No winning bid found"),c=n.encoder.encode("collectAuctionPayout",[r]),o=n.encoder.encode("collectAuctionTokens",[r]),t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[[c,o]]}));case 13:if(t.prev=13,t.t0=t.catch(3),!t.t0.message.includes("Marketplace: auction still active.")){t.next=19;break}throw new k.w(r.toString(),e.endTimeInSeconds.toString());case 19:throw t.t0;case 20:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r,this.storage=e,this.events=new C.a(this.contractWrapper),this.encoder=new h.C(this.contractWrapper),this.interceptor=new W.C(this.contractWrapper),this.estimator=new C.G(this.contractWrapper)}return(0,i.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getTotalCount",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("totalAuctions",[]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAll",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a,c,o,i,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=p.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No auctions exist on the contract.");case 7:return c=[],t.next=10,(0,b.g)(n,a,(function(t,r){return u.contractWrapper.read("getAllAuctions",[t,r])}));case 10:return o=t.sent,c=o.flat(),t.next=14,this.applyFilter(c,r);case 14:return i=t.sent,t.next=17,Promise.all(i.map((function(t){return u.mapAuction(t)})));case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllValid",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a,c,o,i,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=p.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No auctions exist on the contract.");case 7:return c=[],t.next=10,(0,b.g)(n,a,(function(t,r){return u.contractWrapper.read("getAllValidAuctions",[t,r])}));case 10:return o=t.sent,c=o.flat(),t.next=14,this.applyFilter(c,r);case 14:return i=t.sent,t.next=17,Promise.all(i.map((function(t){return u.mapAuction(t)})));case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAuction",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("getAuction",[r]);case 2:return e=t.sent,t.next=5,this.mapAuction(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getWinningBid",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(p.O$.from(r));case 2:return t.next=4,this.contractWrapper.read("getWinningBid",[r]);case 4:if((e=t.sent)._bidder!==l.d){t.next=7;break}return t.abrupt("return",void 0);case 7:return t.next=9,this.mapBid(r.toString(),e._bidder,e._currency,e._bidAmount.toString());case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isWinningBid",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("isNewWinningBid",[r,e]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"getWinner",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a,c,o,i,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateAuction(p.O$.from(r));case 2:return e=t.sent,t.next=5,this.contractWrapper.read("getWinningBid",[r]);case 5:if(n=t.sent,a=p.O$.from(Math.floor(Date.now()/1e3)),c=p.O$.from(e.endTimeInSeconds),!a.gt(c)||n._bidder===l.d){t.next=10;break}return t.abrupt("return",n._bidder);case 10:return o=new C.a(this.contractWrapper),t.next=13,o.getEvents("AuctionClosed");case 13:if(i=t.sent,u=i.find((function(t){return t.data.auctionId.eq(p.O$.from(r))}))){t.next=17;break}throw new Error("Could not find auction with ID ".concat(r," in closed auctions"));case 17:return t.abrupt("return",u.data.winningBidder);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getBidBufferBps",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAuction(r);case 2:return t.abrupt("return",t.sent.bidBufferBps);case 3:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getMinimumNextBid",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,a,c,o,i,u,d;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this.getBidBufferBps(r),this.getWinningBid(r),this.validateAuction(p.O$.from(r))]);case 2:return e=t.sent,a=(0,n.Z)(e,3),c=a[0],o=a[1],i=a[2],u=o?p.O$.from(o.bidAmount):p.O$.from(i.minimumBidAmount),d=u.add(u.mul(c).div(1e4)),t.abrupt("return",(0,h.a)(this.contractWrapper.getProvider(),i.currencyContractAddress,d));case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"validateAuction",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getAuction(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the auction with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapAuction",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=L.UNSET,t.next=3,this.contractWrapper.getProvider().getBlock("latest");case 3:n=t.sent,a=n.timestamp,t.t0=r.status,t.next=1===t.t0?8:2===t.t0?10:3===t.t0?12:14;break;case 8:return e=p.O$.from(r.startTimestamp).gt(a)?L.Created:p.O$.from(r.endTimestamp).lt(a)?L.Expired:L.Active,t.abrupt("break",14);case 10:return e=L.Completed,t.abrupt("break",14);case 12:return e=L.Cancelled,t.abrupt("break",14);case 14:return t.t1=r.auctionId.toString(),t.t2=r.auctionCreator,t.t3=r.assetContract,t.t4=r.tokenId.toString(),t.t5=r.quantity.toString(),t.t6=r.currency,t.t7=r.minimumBidAmount.toString(),t.next=23,(0,h.a)(this.contractWrapper.getProvider(),r.currency,r.minimumBidAmount);case 23:return t.t8=t.sent,t.t9=r.buyoutBidAmount.toString(),t.next=27,(0,h.a)(this.contractWrapper.getProvider(),r.currency,r.buyoutBidAmount);case 27:return t.t10=t.sent,t.t11=p.O$.from(r.timeBufferInSeconds).toNumber(),t.t12=p.O$.from(r.bidBufferBps).toNumber(),t.t13=p.O$.from(r.startTimestamp).toNumber(),t.t14=p.O$.from(r.endTimestamp).toNumber(),t.next=34,(0,w.c)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 34:return t.t15=t.sent,t.t16=e,t.abrupt("return",{id:t.t1,creatorAddress:t.t2,assetContractAddress:t.t3,tokenId:t.t4,quantity:t.t5,currencyContractAddress:t.t6,minimumBidAmount:t.t7,minimumBidCurrencyValue:t.t8,buyoutBidAmount:t.t9,buyoutCurrencyValue:t.t10,timeBufferInSeconds:t.t11,bidBufferBps:t.t12,startTimeInSeconds:t.t13,endTimeInSeconds:t.t14,asset:t.t15,status:t.t16});case 37:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"mapBid",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e,n,a){var c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,k.aL)(e);case 2:return c=t.sent,t.next=5,(0,k.aL)(n);case 5:return o=t.sent,t.t0=r,t.t1=c,t.t2=o,t.t3=a,t.next=12,(0,h.a)(this.contractWrapper.getProvider(),o,a);case 12:return t.t4=t.sent,t.abrupt("return",{auctionId:t.t0,bidderAddress:t.t1,currencyContractAddress:t.t2,bidAmount:t.t3,bidAmountCurrencyValue:t.t4});case 14:case"end":return t.stop()}}),t,this)})));return function(r,e,n,a){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var n,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(0,a.Z)(r),!e){t.next=13;break}if(!e.seller){t.next=7;break}return t.next=5,(0,k.aL)(e.seller);case 5:c=t.sent,n=n.filter((function(t){return t.auctionCreator.toString().toLowerCase()===(null===c||void 0===c?void 0:c.toString().toLowerCase())}));case 7:if(!e.tokenContract){t.next=12;break}return t.next=10,(0,k.aL)(e.tokenContract);case 10:o=t.sent,n=n.filter((function(t){return t.assetContract.toString().toLowerCase()===(null===o||void 0===o?void 0:o.toString().toLowerCase())}));case 12:void 0!==e.tokenId&&(n=n.filter((function(t){var r;return t.tokenId.toString()===(null===e||void 0===e||null===(r=e.tokenId)||void 0===r?void 0:r.toString())})));case 13:return t.abrupt("return",null!==e&&void 0!==e&&e.count&&e.count<n.length?n.slice(0,e.count):n);case 14:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}()}]),t}(),B=function(){return A.z.object({assetContractAddress:k.b9,tokenId:k.b6,quantity:k.b6.default(1),currencyContractAddress:k.b9.default(k.aV),totalPrice:k.cv,endTimestamp:Z.E})}(),S=function(){function t(r,e){var n=this;(0,o.Z)(this,t),(0,u.Z)(this,"featureName",k.dy.name),(0,u.Z)(this,"makeOffer",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,a,c,o,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.parseAsync(r);case 2:return e=t.sent,t.next=5,n.contractWrapper.getChainID();case 5:return a=t.sent,c=(0,h.i)(e.currencyContractAddress)?k.aW[a].wrapped.address:e.currencyContractAddress,t.next=9,(0,g.n)(n.contractWrapper.getProvider(),e.totalPrice,c);case 9:return o=t.sent,t.next=12,n.contractWrapper.getCallOverrides();case 12:return i=t.sent,t.next=15,(0,x.s)(n.contractWrapper,o,c,i);case 15:return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"makeOffer",args:[{assetContract:e.assetContractAddress,tokenId:e.tokenId,quantity:e.quantity,currency:c,totalPrice:o,expirationTimestamp:e.endTimestamp}],parse:function(t){return{id:n.contractWrapper.parseLogs("NewOffer",null===t||void 0===t?void 0:t.logs)[0].args.offerId,receipt:t}}}));case 16:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"cancelOffer",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"cancelOffer",args:[r]}));case 1:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"acceptOffer",(0,y.d)(function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,a,c,o,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateOffer(p.O$.from(r));case 2:return e=t.sent,t.next=5,n.isStillValidOffer(e);case 5:if(a=t.sent,c=a.valid,o=a.error,c){t.next=10;break}throw new Error("Offer ".concat(r," is no longer valid. ").concat(o));case 10:return t.next=12,n.contractWrapper.getCallOverrides();case 12:if(t.t0=t.sent,t.t0){t.next=15;break}t.t0={};case 15:return i=t.t0,t.t1=b.h,t.t2=n.contractWrapper,t.t3=n.getAddress(),t.t4=e.assetContractAddress,t.t5=e.tokenId,t.next=23,n.contractWrapper.getSignerAddress();case 23:return t.t6=t.sent,t.next=26,(0,t.t1)(t.t2,t.t3,t.t4,t.t5,t.t6);case 26:return t.abrupt("return",y.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"acceptOffer",args:[r],overrides:i}));case 27:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r,this.storage=e,this.events=new C.a(this.contractWrapper),this.encoder=new h.C(this.contractWrapper),this.interceptor=new W.C(this.contractWrapper),this.estimator=new C.G(this.contractWrapper)}return(0,i.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getTotalCount",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("totalOffers",[]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAll",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a,c,o,i,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=p.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No offers exist on the contract.");case 7:return c=[],t.next=10,(0,b.g)(n,a,(function(t,r){return u.contractWrapper.read("getAllOffers",[t,r])}));case 10:return o=t.sent,c=o.flat(),t.next=14,this.applyFilter(c,r);case 14:return i=t.sent,t.next=17,Promise.all(i.map((function(t){return u.mapOffer(t)})));case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllValid",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a,c,o,i,u=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTotalCount();case 2:if(e=t.sent,n=p.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),0!==(a=e.toNumber())){t.next=7;break}throw new Error("No offers exist on the contract.");case 7:return c=[],t.next=10,(0,b.g)(n,a,(function(t,r){return u.contractWrapper.read("getAllValidOffers",[t,r])}));case 10:return o=t.sent,c=o.flat(),t.next=14,this.applyFilter(c,r);case 14:return i=t.sent,t.next=17,Promise.all(i.map((function(t){return u.mapOffer(t)})));case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getOffer",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("getOffer",[r]);case 2:return e=t.sent,t.next=5,this.mapOffer(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"validateOffer",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getOffer(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the offer with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapOffer",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var e,n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=L.UNSET,t.next=3,this.contractWrapper.getProvider().getBlock("latest");case 3:n=t.sent,a=n.timestamp,t.t0=r.status,t.next=1===t.t0?8:2===t.t0?10:3===t.t0?12:14;break;case 8:return e=p.O$.from(r.expirationTimestamp).lt(a)?L.Expired:L.Active,t.abrupt("break",14);case 10:return e=L.Completed,t.abrupt("break",14);case 12:return e=L.Cancelled,t.abrupt("break",14);case 14:return t.t1=r.offerId.toString(),t.t2=r.offeror,t.t3=r.assetContract,t.t4=r.currency,t.t5=r.tokenId.toString(),t.t6=r.quantity.toString(),t.t7=r.totalPrice.toString(),t.next=23,(0,h.a)(this.contractWrapper.getProvider(),r.currency,r.totalPrice);case 23:return t.t8=t.sent,t.next=26,(0,w.c)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 26:return t.t9=t.sent,t.t10=p.O$.from(r.expirationTimestamp).toNumber(),t.t11=e,t.abrupt("return",{id:t.t1,offerorAddress:t.t2,assetContractAddress:t.t3,currencyContractAddress:t.t4,tokenId:t.t5,quantity:t.t6,totalPrice:t.t7,currencyValue:t.t8,asset:t.t9,endTimeInSeconds:t.t10,status:t.t11});case 30:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isStillValidOffer",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r){var n,a,c,o,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!p.O$.from(Math.floor(Date.now()/1e3)).gt(r.endTimeInSeconds)){t.next=3;break}return t.abrupt("return",{valid:!1,error:"Offer with ID ".concat(r.id," has expired")});case 3:return t.next=5,this.contractWrapper.getChainID();case 5:return n=t.sent,a=(0,h.i)(r.currencyContractAddress)?k.aW[n].wrapped.address:r.currencyContractAddress,c=this.contractWrapper.getProvider(),t.next=10,Promise.resolve().then(e.t.bind(e,49242,19));case 10:return o=t.sent.default,i=new k.cq(c,a,o,{},this.storage),t.next=14,i.read("balanceOf",[r.offerorAddress]);case 14:if(!t.sent.lt(r.totalPrice)){t.next=17;break}return t.abrupt("return",{valid:!1,error:"Offeror ".concat(r.offerorAddress," doesn't have enough balance of token ").concat(a)});case 17:return t.next=19,i.read("allowance",[r.offerorAddress,this.getAddress()]);case 19:if(!t.sent.lt(r.totalPrice)){t.next=22;break}return t.abrupt("return",{valid:!1,error:"Offeror ".concat(r.offerorAddress," hasn't approved enough amount of token ").concat(a)});case 22:return t.abrupt("return",{valid:!0,error:""});case 23:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(){var t=(0,c.Z)((0,s.Z)().mark((function t(r,e){var n,c,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(0,a.Z)(r),!e){t.next=13;break}if(!e.offeror){t.next=7;break}return t.next=5,(0,k.aL)(e.offeror);case 5:c=t.sent,n=n.filter((function(t){return t.offeror.toString().toLowerCase()===(null===c||void 0===c?void 0:c.toString().toLowerCase())}));case 7:if(!e.tokenContract){t.next=12;break}return t.next=10,(0,k.aL)(e.tokenContract);case 10:o=t.sent,n=n.filter((function(t){return t.assetContract.toString().toLowerCase()===(null===o||void 0===o?void 0:o.toString().toLowerCase())}));case 12:void 0!==e.tokenId&&(n=n.filter((function(t){var r;return t.tokenId.toString()===(null===e||void 0===e||null===(r=e.tokenId)||void 0===r?void 0:r.toString())})));case 13:return t.abrupt("return",null!==e&&void 0!==e&&e.count&&e.count<n.length?n.slice(0,e.count):n);case 14:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}()}]),t}()}}]);
//# sourceMappingURL=7019.922a41b2.chunk.js.map