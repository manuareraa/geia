"use strict";(self.webpackChunkgeoblocs=self.webpackChunkgeoblocs||[]).push([[1377],{80391:function(t,r,e){e.d(r,{D:function(){return A},F:function(){return l},I:function(){return d},a:function(){return f},b:function(){return x},c:function(){return g},f:function(){return h},g:function(){return y},u:function(){return k}});var n=e(29439),a=e(74165),s=e(1413),i=e(15861),c=e(75580),o=e(49716),u=e(2257),p=e(34029),d=function(){return o.arrayify("0x80ac58cd")}(),f=function(){return o.arrayify("0xd9b67a26")}(),l={name:"Failed to load NFT metadata"};function h(t,r,e){return v.apply(this,arguments)}function v(){return(v=(0,i.Z)((0,a.Z)().mark((function t(r,e,n){var i,p,d,f,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.startsWith("data:application/json;base64")||"undefined"===typeof Buffer){t.next=4;break}return i=e.split(",")[1],p=JSON.parse(Buffer.from(i,"base64").toString("utf-8")),t.abrupt("return",c.C.parse((0,s.Z)((0,s.Z)({},p),{},{id:u.O$.from(r).toString(),uri:e})));case 4:return d=e.replace("{id}",o.hexZeroPad(u.O$.from(r).toHexString(),32).slice(2)),t.prev=5,t.next=8,n.downloadJSON(d);case 8:f=t.sent,t.next=24;break;case 11:return t.prev=11,t.t0=t.catch(5),h=e.replace("{id}",u.O$.from(r).toString()),t.prev=14,t.next=17,n.downloadJSON(h);case 17:f=t.sent,t.next=24;break;case 20:t.prev=20,t.t1=t.catch(14),console.warn("failed to get token metadata: ".concat(JSON.stringify({tokenId:r.toString(),tokenUri:e})," -- falling back to default metadata")),f=l;case 24:return t.abrupt("return",c.C.parse((0,s.Z)((0,s.Z)({},f),{},{id:u.O$.from(r).toString(),uri:e})));case 25:case"end":return t.stop()}}),t,null,[[5,11],[14,20]])})))).apply(this,arguments)}function g(t,r,e,n){return m.apply(this,arguments)}function m(){return(m=(0,i.Z)((0,a.Z)().mark((function t(r,i,o,v){var g,m,x,w,k,b,y,Z,W,A,C;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.e(5025).then(e.t.bind(e,25025,19));case 2:return m=t.sent.default,x=new p.CH(r,m,i),t.next=6,Promise.all([x.supportsInterface(d),x.supportsInterface(f)]);case 6:if(w=t.sent,k=(0,n.Z)(w,2),b=k[0],y=k[1],!b){t.next=20;break}return t.next=13,Promise.resolve().then(e.t.bind(e,34161,19));case 13:return Z=t.sent.default,W=new p.CH(r,Z,i),t.next=17,W.tokenURI(o);case 17:case 27:g=t.sent,t.next=31;break;case 20:if(!y){t.next=30;break}return t.next=23,Promise.resolve().then(e.t.bind(e,50266,19));case 23:return A=t.sent.default,C=new p.CH(r,A,i),t.next=27,C.uri(o);case 30:throw Error("Contract must implement ERC 1155 or ERC 721.");case 31:if(g){t.next=33;break}return t.abrupt("return",c.C.parse((0,s.Z)((0,s.Z)({},l),{},{id:u.O$.from(o).toString(),uri:""})));case 33:return t.abrupt("return",h(o,g,v));case 34:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t,r){return w.apply(this,arguments)}function w(){return(w=(0,i.Z)((0,a.Z)().mark((function t(r,e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!==typeof r){t.next=4;break}return t.abrupt("return",r);case 4:return t.next=6,e.upload(c.a.parse(r));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t,r,e,n){return b.apply(this,arguments)}function b(){return(b=(0,i.Z)((0,a.Z)().mark((function t(r,e,n,s){var i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Z(r)){t.next=4;break}return t.abrupt("return",r);case 4:if(!W(r)){t.next=11;break}return t.next=7,e.uploadBatch(r.map((function(t){return c.a.parse(t)})),{rewriteFileNames:{fileStartNumber:n||0},onProgress:null===s||void 0===s?void 0:s.onProgress});case 7:return i=t.sent,t.abrupt("return",i);case 11:throw new Error("NFT metadatas must all be of the same type (all URI or all NFTMetadataInput)");case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function y(t){for(var r=t[0].substring(0,t[0].lastIndexOf("/")),e=0;e<t.length;e++){var n=t[e].substring(0,t[e].lastIndexOf("/"));if(r!==n)throw new Error("Can only create batches with the same base URI for every entry in the batch. Expected '".concat(r,"' but got '").concat(n,"'"))}return r.replace(/\/$/,"")+"/"}function Z(t){return void 0===t.find((function(t){return"string"!==typeof t}))}function W(t){return void 0===t.find((function(t){return"object"!==typeof t}))}var A=100},15856:function(t,r,e){e.d(r,{c:function(){return s}});var n=e(68365),a=e(31714);function s(t){return(0,a.i)(t)?n.aV:t}},72106:function(t,r,e){e.d(r,{C:function(){return s}});var n=e(15671),a=e(43144),s=function(){function t(r){(0,n.Z)(this,t),this.contractWrapper=r}return(0,a.Z)(t,[{key:"overrideNextTransaction",value:function(t){this.contractWrapper.withTransactionOverride(t)}}]),t}()},84969:function(t,r,e){e.d(r,{C:function(){return d}});var n=e(29439),a=e(74165),s=e(15861),i=e(15671),c=e(43144),o=e(4942),u=e(36980),p=e(68365),d=function(){function t(r){var e=this;(0,i.Z)(this,t),(0,o.Z)(this,"featureName",p.dq.name),(0,o.Z)(this,"set",(0,u.d)(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(r){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.bF.parseAsync(r);case 2:return n=t.sent,t.abrupt("return",u.T.fromContractWrapper({contractWrapper:e.contractWrapper,method:"setPlatformFeeInfo",args:[n.platform_fee_recipient,n.platform_fee_basis_points]}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r}return(0,c.Z)(t,[{key:"get",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var r,e,s,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("getPlatformFeeInfo",[]);case 2:return r=t.sent,e=(0,n.Z)(r,2),s=e[0],i=e[1],t.abrupt("return",p.bF.parseAsync({platform_fee_recipient:s,platform_fee_basis_points:i}));case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}()},27161:function(t,r,e){e.d(r,{a:function(){return w},g:function(){return k},h:function(){return h},i:function(){return f},m:function(){return m},v:function(){return g}});var n=e(74165),a=e(29439),s=e(15861),i=e(34029),c=e(2257),o=e(44554),u=e(80391),p=e(68365),d=e(31714);function f(t,r,e,n,a){return l.apply(this,arguments)}function l(){return(l=(0,s.Z)((0,n.Z)().mark((function t(r,s,c,o,p){var d,f,l,h,v,g,m,x,w,k,b,y;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.e(5025).then(e.t.bind(e,25025,19));case 3:return d=t.sent.default,f=new i.CH(c,d,r),t.next=7,Promise.all([f.supportsInterface(u.I),f.supportsInterface(u.a)]);case 7:if(l=t.sent,h=(0,a.Z)(l,2),v=h[0],g=h[1],!v){t.next=32;break}return t.next=14,Promise.resolve().then(e.t.bind(e,70332,19));case 14:return x=t.sent.default,w=new i.CH(c,x,r),t.next=18,w.isApprovedForAll(p,s);case 18:if(!t.sent){t.next=21;break}return t.abrupt("return",!0);case 21:return t.prev=21,t.next=24,w.getApproved(o);case 24:k=t.sent,t.next=29;break;case 27:t.prev=27,t.t0=t.catch(21);case 29:return t.abrupt("return",(null===(m=k)||void 0===m?void 0:m.toLowerCase())===s.toLowerCase());case 32:if(!g){t.next=42;break}return t.next=35,Promise.resolve().then(e.t.bind(e,8455,19));case 35:return b=t.sent.default,y=new i.CH(c,b,r),t.next=39,y.isApprovedForAll(p,s);case 39:return t.abrupt("return",t.sent);case 42:return console.error("Contract does not implement ERC 1155 or ERC 721."),t.abrupt("return",!1);case 44:t.next=50;break;case 46:return t.prev=46,t.t1=t.catch(0),console.error("Failed to check if token is approved",t.t1),t.abrupt("return",!1);case 50:case"end":return t.stop()}}),t,null,[[0,46],[21,27]])})))).apply(this,arguments)}function h(t,r,e,n,a){return v.apply(this,arguments)}function v(){return(v=(0,s.Z)((0,n.Z)().mark((function t(r,s,i,c,o){var d,f,l,h,v,g,m,x,w,k;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.e(5025).then(e.t.bind(e,25025,19));case 2:return d=t.sent.default,f=new p.cq(r.getSignerOrProvider(),i,d,r.options,r.storage),t.next=6,Promise.all([f.read("supportsInterface",[u.I]),f.read("supportsInterface",[u.a])]);case 6:if(l=t.sent,h=(0,a.Z)(l,2),v=h[0],g=h[1],!v){t.next=29;break}return t.next=13,Promise.resolve().then(e.t.bind(e,70332,19));case 13:return m=t.sent.default,x=new p.cq(r.getSignerOrProvider(),i,m,r.options,r.storage),t.next=17,x.read("isApprovedForAll",[o,s]);case 17:if(t.sent){t.next=27;break}return t.next=21,x.read("getApproved",[c]);case 21:if(t.t0=t.sent.toLowerCase(),t.t1=s.toLowerCase(),t.t0===t.t1){t.next=27;break}return t.next=27,x.sendTransaction("setApprovalForAll",[s,!0]);case 27:case 40:t.next=43;break;case 29:if(!g){t.next=42;break}return t.next=32,Promise.resolve().then(e.t.bind(e,8455,19));case 32:return w=t.sent.default,k=new p.cq(r.getSignerOrProvider(),i,w,r.options,r.storage),t.next=36,k.read("isApprovedForAll",[o,s]);case 36:if(t.sent){t.next=40;break}return t.next=40,k.sendTransaction("setApprovalForAll",[s,!0]);case 42:throw Error("Contract must implement ERC 1155 or ERC 721.");case 43:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){if((0,o.Z)(void 0!==t.assetContractAddress&&null!==t.assetContractAddress,"Asset contract address is required"),(0,o.Z)(void 0!==t.buyoutPricePerToken&&null!==t.buyoutPricePerToken,"Buyout price is required"),(0,o.Z)(void 0!==t.listingDurationInSeconds&&null!==t.listingDurationInSeconds,"Listing duration is required"),(0,o.Z)(void 0!==t.startTimestamp&&null!==t.startTimestamp,"Start time is required"),(0,o.Z)(void 0!==t.tokenId&&null!==t.tokenId,"Token ID is required"),(0,o.Z)(void 0!==t.quantity&&null!==t.quantity,"Quantity is required"),"NewAuctionListing"===t.type)(0,o.Z)(void 0!==t.reservePricePerToken&&null!==t.reservePricePerToken,"Reserve price is required")}function m(t,r,e){return x.apply(this,arguments)}function x(){return(x=(0,s.Z)((0,n.Z)().mark((function t(r,e,a){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a.quantityDesired,t.t1=a.pricePerToken,t.t2=a.currency,t.t3=a.offeror,t.t4=a.quantityWanted,t.next=7,(0,d.a)(r,a.currency,a.quantityWanted.mul(a.pricePerToken));case 7:return t.t5=t.sent,t.t6=e,t.abrupt("return",{quantity:t.t0,pricePerToken:t.t1,currencyContractAddress:t.t2,buyerAddress:t.t3,quantityDesired:t.t4,currencyValue:t.t5,listingId:t.t6});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t,r,e){return e=c.O$.from(e),t=c.O$.from(t),r=c.O$.from(r),!t.eq(c.O$.from(0))&&r.sub(t).mul(p.dA).div(t).gte(e)}function k(t,r,e){return b.apply(this,arguments)}function b(){return(b=(0,s.Z)((0,n.Z)().mark((function t(r,e,a){var s;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(s=[];e-r>u.D;)s.push(a(r,r+u.D-1)),r+=u.D;return s.push(a(r,e-1)),t.next=5,Promise.all(s);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},81377:function(t,r,e){e.r(r),e.d(r,{Marketplace:function(){return S}});var n=e(93433),a=e(29439),s=e(74165),i=e(15861),c=e(15671),o=e(43144),u=e(4942),p=e(2257),d=e(6222),f=e(75422),l=e(68624),h=e(97419),v=e(34029),g=e(44554),m=e(80391),x=e(31714),w=e(68365),k=e(27161),b=e(36980),y=e(31109),Z=e(72106),W=e(84969),A=e(46491),C=e(15856),T=e(46413),P=e(75580),L=function(t){return t[t.Direct=0]="Direct",t[t.Auction=1]="Auction",t}({}),I=(e(80518),e(66315),e(98528),function(){function t(r,e){var n=this;(0,c.Z)(this,t),(0,u.Z)(this,"createListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,a,i,c,o,u,d;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(0,k.v)(r),t.next=3,(0,w.aL)(r.assetContractAddress);case 3:return e=t.sent,t.next=6,(0,w.aL)(r.currencyContractAddress);case 6:return a=t.sent,t.t0=k.h,t.t1=n.contractWrapper,t.t2=n.getAddress(),t.t3=e,t.t4=r.tokenId,t.next=14,n.contractWrapper.getSignerAddress();case 14:return t.t5=t.sent,t.next=17,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 17:return t.next=19,(0,T.n)(n.contractWrapper.getProvider(),r.buyoutPricePerToken,a);case 19:return i=t.sent,t.next=22,(0,T.n)(n.contractWrapper.getProvider(),r.reservePricePerToken,a);case 22:return c=t.sent,o=Math.floor(r.startTimestamp.getTime()/1e3),t.next=26,n.contractWrapper.getProvider().getBlock("latest");case 26:return u=t.sent,d=u.timestamp,o<d&&(o=d),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"createListing",args:[{assetContract:e,tokenId:r.tokenId,buyoutPricePerToken:i,currencyToAccept:(0,C.c)(a),listingType:L.Auction,quantityToList:r.quantity,reservePricePerToken:c,secondsUntilEndTime:r.listingDurationInSeconds,startTime:p.O$.from(o)}],parse:function(t){return{id:n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs)[0].args.listingId,receipt:t}}}));case 30:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"createListingsBatch",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map((function(t){return n.createListing.prepare(t)})));case 2:return e=t.sent.map((function(t){return t.encode()})),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[e],parse:function(t){return n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs).map((function(r){return{id:r.args.listingId,receipt:t}}))}}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"buyoutListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return e=t.sent,t.next=5,(0,x.f)(n.contractWrapper.getProvider(),e.currencyContractAddress);case 5:return a=t.sent,t.abrupt("return",n.makeBid.prepare(r,d.formatUnits(e.buyoutPrice,a.decimals)));case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"makeBid",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var a,i,c,o,u,d,l,h,v,m;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return a=t.sent,t.next=5,(0,T.n)(n.contractWrapper.getProvider(),e,a.currencyContractAddress);case 5:if(!(i=t.sent).eq(p.O$.from(0))){t.next=8;break}throw new Error("Cannot make a bid with 0 value");case 8:return t.next=10,n.contractWrapper.read("bidBufferBps",[]);case 10:return c=t.sent,t.next=13,n.getWinningBid(r);case 13:return(o=t.sent)?(u=(0,k.a)(o.pricePerToken,i,c),(0,g.Z)(u,"Bid price is too low based on the current winning bid and the bid buffer")):(d=i,l=p.O$.from(a.reservePrice),(0,g.Z)(d.gte(l),"Bid price is too low based on reserve price")),h=p.O$.from(a.quantity),v=i.mul(h),t.next=19,n.contractWrapper.getCallOverrides();case 19:if(t.t0=t.sent,t.t0){t.next=22;break}t.t0={};case 22:return m=t.t0,t.next=25,(0,P.s)(n.contractWrapper,v,a.currencyContractAddress,m);case 25:return t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"offer",args:[r,a.quantity,a.currencyContractAddress,i,f.Bz],overrides:m}));case 26:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"cancelListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,a,i,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return e=t.sent,a=p.O$.from(Math.floor(Date.now()/1e3)),i=p.O$.from(e.startTimeInEpochSeconds),t.next=7,n.contractWrapper.read("winningBid",[r]);case 7:if(c=t.sent,!a.gt(i)||c.offeror===l.d){t.next=10;break}throw new w.t(r.toString());case 10:return t.t0=b.T,t.t1=n.contractWrapper,t.t2=p.O$.from(r),t.next=15,n.contractWrapper.getSignerAddress();case 15:return t.t3=t.sent,t.t4=[t.t2,t.t3],t.t5={contractWrapper:t.t1,method:"closeAuction",args:t.t4},t.abrupt("return",t.t0.fromContractWrapper.call(t.t0,t.t5));case 19:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"closeListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=4;break}return t.next=3,n.contractWrapper.getSignerAddress();case 3:e=t.sent;case 4:return t.next=6,n.validateListing(p.O$.from(r));case 6:return a=t.sent,t.prev=7,t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"closeAuction",args:[p.O$.from(r),e]}));case 11:if(t.prev=11,t.t0=t.catch(7),!t.t0.message.includes("cannot close auction before it has ended")){t.next=17;break}throw new w.w(r.toString(),a.endTimeInEpochSeconds.toString());case 17:throw t.t0;case 18:case"end":return t.stop()}}),t,null,[[7,11]])})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"executeSale",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,a,i,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return e=t.sent,t.prev=3,t.next=6,n.getWinningBid(r);case 6:return a=t.sent,(0,g.Z)(a,"No winning bid found"),i=n.encoder.encode("closeAuction",[r,e.sellerAddress]),c=n.encoder.encode("closeAuction",[r,a.buyerAddress]),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[i,c]}));case 13:if(t.prev=13,t.t0=t.catch(3),!t.t0.message.includes("cannot close auction before it has ended")){t.next=19;break}throw new w.w(r.toString(),e.endTimeInEpochSeconds.toString());case 19:throw t.t0;case 20:case"end":return t.stop()}}),t,null,[[3,13]])})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"updateListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"updateListing",args:[r.id,r.quantity,r.reservePrice,r.buyoutPrice,r.currencyContractAddress,r.startTimeInEpochSeconds,r.endTimeInEpochSeconds]}));case 1:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r,this.storage=e,this.encoder=new x.C(r)}return(0,o.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("listings",[r]);case 2:if((e=t.sent).listingId.toString()===r.toString()){t.next=5;break}throw new w.L(this.getAddress(),r.toString());case 5:if(e.listingType===L.Auction){t.next=7;break}throw new w.W(this.getAddress(),r.toString(),"Direct","Auction");case 7:return t.next=9,this.mapListing(e);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getWinningBid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(p.O$.from(r));case 2:return t.next=4,this.contractWrapper.read("winningBid",[r]);case 4:if((e=t.sent).offeror!==l.d){t.next=7;break}return t.abrupt("return",void 0);case 7:return t.next=9,(0,k.m)(this.contractWrapper.getProvider(),p.O$.from(r),e);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getWinner",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a,i,c,o,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(p.O$.from(r));case 2:return e=t.sent,t.next=5,this.contractWrapper.read("winningBid",[r]);case 5:if(n=t.sent,a=p.O$.from(Math.floor(Date.now()/1e3)),i=p.O$.from(e.endTimeInEpochSeconds),!a.gt(i)||n.offeror===l.d){t.next=10;break}return t.abrupt("return",n.offeror);case 10:return c=new y.a(this.contractWrapper),t.next=13,c.getEvents("AuctionClosed");case 13:if(o=t.sent,u=o.find((function(t){return t.data.listingId.eq(p.O$.from(r))}))){t.next=17;break}throw new Error("Could not find auction with listingId ".concat(r," in closed auctions"));case 17:return t.abrupt("return",u.data.winningBidder);case 18:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getBidBufferBps",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.read("bidBufferBps",[]));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getMinimumNextBid",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,i,c,o,u,d;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this.getBidBufferBps(),this.getWinningBid(r),this.validateListing(p.O$.from(r))]);case 2:return e=t.sent,n=(0,a.Z)(e,3),i=n[0],c=n[1],o=n[2],u=c?c.currencyValue.value:o.reservePrice,d=u.add(u.mul(i).div(1e4)),t.abrupt("return",(0,x.a)(this.contractWrapper.getProvider(),o.currencyContractAddress,d));case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"validateListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getListing(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the listing with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r.assetContract,t.t1=p.O$.from(r.buyoutPricePerToken),t.t2=r.currency,t.next=5,(0,x.a)(this.contractWrapper.getProvider(),r.currency,r.buyoutPricePerToken);case 5:return t.t3=t.sent,t.t4=r.listingId.toString(),t.t5=r.tokenId,t.t6=r.quantity,t.t7=r.startTime,t.next=12,(0,m.c)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 12:return t.t8=t.sent,t.next=15,(0,x.a)(this.contractWrapper.getProvider(),r.currency,r.reservePricePerToken);case 15:return t.t9=t.sent,t.t10=p.O$.from(r.reservePricePerToken),t.t11=r.endTime,t.t12=r.tokenOwner,t.t13=L.Auction,t.abrupt("return",{assetContractAddress:t.t0,buyoutPrice:t.t1,currencyContractAddress:t.t2,buyoutCurrencyValuePerToken:t.t3,id:t.t4,tokenId:t.t5,quantity:t.t6,startTimeInEpochSeconds:t.t7,asset:t.t8,reservePriceCurrencyValuePerToken:t.t9,reservePrice:t.t10,endTimeInEpochSeconds:t.t11,sellerAddress:t.t12,type:t.t13});case 21:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()}]),t}()),O=function(){function t(r,e){var n=this;(0,c.Z)(this,t),(0,u.Z)(this,"createListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,a,i,c,o,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(0,k.v)(r),t.next=3,(0,w.aL)(r.assetContractAddress);case 3:return e=t.sent,t.next=6,(0,w.aL)(r.currencyContractAddress);case 6:return a=t.sent,t.t0=k.h,t.t1=n.contractWrapper,t.t2=n.getAddress(),t.t3=e,t.t4=r.tokenId,t.next=14,n.contractWrapper.getSignerAddress();case 14:return t.t5=t.sent,t.next=17,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5);case 17:return t.next=19,(0,T.n)(n.contractWrapper.getProvider(),r.buyoutPricePerToken,a);case 19:return i=t.sent,c=Math.floor(r.startTimestamp.getTime()/1e3),t.next=23,n.contractWrapper.getProvider().getBlock("latest");case 23:return o=t.sent,u=o.timestamp,c<u&&(c=u),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"createListing",args:[{assetContract:e,tokenId:r.tokenId,buyoutPricePerToken:i,currencyToAccept:(0,C.c)(a),listingType:L.Direct,quantityToList:r.quantity,reservePricePerToken:i,secondsUntilEndTime:r.listingDurationInSeconds,startTime:p.O$.from(c)}],parse:function(t){return{id:n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs)[0].args.listingId,receipt:t}}}));case 27:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"createListingsBatch",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map((function(t){return n.createListing.prepare(t)})));case 2:return e=t.sent.map((function(t){return t.encode()})),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"multicall",args:[e],parse:function(t){return n.contractWrapper.parseLogs("ListingAdded",null===t||void 0===t?void 0:t.logs).map((function(r){return{id:r.args.listingId,receipt:t}}))}}));case 4:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"makeOffer",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,a,i,c){var o,u,d,l,h;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,x.i)(a)){t.next=2;break}throw new Error("You must use the wrapped native token address when making an offer with a native token");case 2:return t.next=4,(0,T.n)(n.contractWrapper.getProvider(),i,a);case 4:return o=t.sent,t.prev=5,t.next=8,n.getListing(r);case 8:t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(5),console.error("Failed to get listing, err =",t.t0),new Error("Error getting the listing with id ".concat(r));case 14:return u=p.O$.from(e),d=p.O$.from(o).mul(u),t.next=18,n.contractWrapper.getCallOverrides();case 18:if(t.t1=t.sent,t.t1){t.next=21;break}t.t1={};case 21:return l=t.t1,t.next=24,(0,P.s)(n.contractWrapper,d,a,l);case 24:return h=f.Bz,c&&(h=p.O$.from(Math.floor(c.getTime()/1e3))),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"offer",args:[r,e,a,o,h],overrides:l}));case 27:case"end":return t.stop()}}),t,null,[[5,10]])})));return function(r,e,n,a,s){return t.apply(this,arguments)}}())),(0,u.Z)(this,"acceptOffer",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var a,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return t.next=4,(0,w.aL)(e);case 4:return a=t.sent,t.next=7,n.contractWrapper.read("offers",[r,a]);case 7:return i=t.sent,t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"acceptOffer",args:[r,a,i.currency,i.pricePerToken]}));case 9:case"end":return t.stop()}}),t)})));return function(r,e){return t.apply(this,arguments)}}())),(0,u.Z)(this,"buyoutListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,a){var i,c,o,u,d,f,l,h;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.validateListing(p.O$.from(r));case 2:return i=t.sent,t.next=5,n.isStillValidListing(i,e);case 5:if(c=t.sent,o=c.valid,u=c.error,o){t.next=10;break}throw new Error("Listing ".concat(r," is no longer valid. ").concat(u));case 10:if(!a){t.next=14;break}t.t0=a,t.next=17;break;case 14:return t.next=16,n.contractWrapper.getSignerAddress();case 16:t.t0=t.sent;case 17:return d=t.t0,f=p.O$.from(e),l=p.O$.from(i.buyoutPrice).mul(f),t.next=22,n.contractWrapper.getCallOverrides();case 22:if(t.t1=t.sent,t.t1){t.next=25;break}t.t1={};case 25:return h=t.t1,t.next=28,(0,P.s)(n.contractWrapper,l,i.currencyContractAddress,h);case 28:return t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"buy",args:[r,d,f,i.currencyContractAddress,l],overrides:h}));case 29:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,u.Z)(this,"updateListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=b.T,t.t1=n.contractWrapper,t.t2=r.id,t.t3=r.quantity,t.t4=r.buyoutPrice,t.t5=r.buyoutPrice,t.next=8,(0,w.aL)(r.currencyContractAddress);case 8:return t.t6=t.sent,t.t7=r.startTimeInSeconds,t.t8=r.secondsUntilEnd,t.t9=[t.t2,t.t3,t.t4,t.t5,t.t6,t.t7,t.t8],t.t10={contractWrapper:t.t1,method:"updateListing",args:t.t9},t.abrupt("return",t.t0.fromContractWrapper.call(t.t0,t.t10));case 14:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"cancelListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.T.fromContractWrapper({contractWrapper:n.contractWrapper,method:"cancelDirectListing",args:[r]}));case 1:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),this.contractWrapper=r,this.storage=e}return(0,o.Z)(t,[{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("listings",[r]);case 2:if((e=t.sent).assetContract!==l.d){t.next=5;break}throw new w.L(this.getAddress(),r.toString());case 5:if(e.listingType===L.Direct){t.next=7;break}throw new w.W(this.getAddress(),r.toString(),"Auction","Direct");case 7:return t.next=9,this.mapListing(e);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getActiveOffer",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.validateListing(p.O$.from(r));case 2:return(0,g.Z)(h.isAddress(e),"Address must be a valid address"),t.t0=this.contractWrapper,t.t1=r,t.next=7,(0,w.aL)(e);case 7:return t.t2=t.sent,t.t3=[t.t1,t.t2],t.next=11,t.t0.read.call(t.t0,"offers",t.t3);case 11:if((n=t.sent).offeror!==l.d){t.next=14;break}return t.abrupt("return",void 0);case 14:return t.next=16,(0,k.m)(this.contractWrapper.getProvider(),p.O$.from(r),n);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,this)})));return function(r,e){return t.apply(this,arguments)}}()},{key:"validateListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getListing(r);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),console.error("Error getting the listing with id ".concat(r)),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()},{key:"mapListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=r.assetContract,t.t1=p.O$.from(r.buyoutPricePerToken),t.t2=r.currency,t.next=5,(0,x.a)(this.contractWrapper.getProvider(),r.currency,r.buyoutPricePerToken);case 5:return t.t3=t.sent,t.t4=r.listingId.toString(),t.t5=r.tokenId,t.t6=r.quantity,t.t7=r.startTime,t.next=12,(0,m.c)(r.assetContract,this.contractWrapper.getProvider(),r.tokenId,this.storage);case 12:return t.t8=t.sent,t.t9=r.endTime,t.t10=r.tokenOwner,t.t11=L.Direct,t.abrupt("return",{assetContractAddress:t.t0,buyoutPrice:t.t1,currencyContractAddress:t.t2,buyoutCurrencyValuePerToken:t.t3,id:t.t4,tokenId:t.t5,quantity:t.t6,startTimeInSeconds:t.t7,asset:t.t8,secondsUntilEnd:t.t9,sellerAddress:t.t10,type:t.t11});case 17:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"isStillValidListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,n){var a,i,c,o,u,p,d,f,l,h,g,x,w,b;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,k.i)(this.contractWrapper.getProvider(),this.getAddress(),r.assetContractAddress,r.tokenId,r.sellerAddress);case 2:if(t.sent){t.next=5;break}return t.abrupt("return",{valid:!1,error:"Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress,"' is not approved for transfer")});case 5:return a=this.contractWrapper.getProvider(),t.next=8,e.e(5025).then(e.t.bind(e,25025,19));case 8:return i=t.sent.default,c=new v.CH(r.assetContractAddress,i,a),t.next=12,c.supportsInterface(m.I);case 12:return o=t.sent,t.next=15,c.supportsInterface(m.a);case 15:if(u=t.sent,!o){t.next=33;break}return t.next=19,Promise.resolve().then(e.t.bind(e,70332,19));case 19:return d=t.sent.default,f=new v.CH(r.assetContractAddress,d,a),t.prev=21,t.next=24,f.ownerOf(r.tokenId);case 24:l=t.sent,t.next=29;break;case 27:t.prev=27,t.t0=t.catch(21);case 29:return h=(null===(p=l)||void 0===p?void 0:p.toLowerCase())===r.sellerAddress.toLowerCase(),t.abrupt("return",{valid:h,error:h?void 0:"Seller is not the owner of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," anymore'")});case 33:if(!u){t.next=45;break}return t.next=36,Promise.resolve().then(e.t.bind(e,8455,19));case 36:return g=t.sent.default,x=new v.CH(r.assetContractAddress,g,a),t.next=40,x.balanceOf(r.sellerAddress,r.tokenId);case 40:return w=t.sent,b=w.gte(n||r.quantity),t.abrupt("return",{valid:b,error:b?void 0:"Seller does not have enough balance of Token '".concat(r.tokenId,"' from contract '").concat(r.assetContractAddress," to fulfill the listing")});case 45:return t.abrupt("return",{valid:!1,error:"Contract does not implement ERC 1155 or ERC 721."});case 46:case"end":return t.stop()}}),t,this,[[21,27]])})));return function(r,e){return t.apply(this,arguments)}}()}]),t}(),S=function(){function t(r,e,n){var a=this;(0,c.Z)(this,t),(0,u.Z)(this,"getAll",this.getAllListings),(0,u.Z)(this,"buyoutListing",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,n){var i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.contractWrapper.read("listings",[r]);case 2:if((i=t.sent).listingId.toString()===r.toString()){t.next=5;break}throw new w.L(a.getAddress(),r.toString());case 5:t.t0=i.listingType,t.next=t.t0===L.Direct?8:t.t0===L.Auction?12:15;break;case 8:return(0,g.Z)(void 0!==e,"quantityDesired is required when buying out a direct listing"),t.next=11,a.direct.buyoutListing.prepare(r,e,n);case 11:case 14:return t.abrupt("return",t.sent);case 12:return t.next=14,a.auction.buyoutListing.prepare(r);case 15:throw Error("Unknown listing type: ".concat(i.listingType));case 16:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,u.Z)(this,"makeOffer",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,n){var i,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.contractWrapper.read("listings",[r]);case 2:if((i=t.sent).listingId.toString()===r.toString()){t.next=5;break}throw new w.L(a.getAddress(),r.toString());case 5:return t.next=7,a.contractWrapper.getChainID();case 7:c=t.sent,t.t0=i.listingType,t.next=t.t0===L.Direct?11:t.t0===L.Auction?15:18;break;case 11:return(0,g.Z)(n,"quantity is required when making an offer on a direct listing"),t.next=14,a.direct.makeOffer.prepare(r,n,(0,x.i)(i.currency)?w.aW[c].wrapped.address:i.currency,e);case 14:case 17:return t.abrupt("return",t.sent);case 15:return t.next=17,a.auction.makeBid.prepare(r,e);case 18:throw Error("Unknown listing type: ".concat(i.listingType));case 19:case"end":return t.stop()}}),t)})));return function(r,e,n){return t.apply(this,arguments)}}())),(0,u.Z)(this,"setBidBufferBps",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a.roles,t.t1=["admin"],t.next=4,a.contractWrapper.getSignerAddress();case 4:return t.t2=t.sent,t.next=7,t.t0.verify.call(t.t0,t.t1,t.t2);case 7:return t.next=9,a.getTimeBufferInSeconds();case 9:return e=t.sent,t.abrupt("return",b.T.fromContractWrapper({contractWrapper:a.contractWrapper,method:"setAuctionBuffers",args:[e,p.O$.from(r)]}));case 11:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"setTimeBufferInSeconds",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a.roles,t.t1=["admin"],t.next=4,a.contractWrapper.getSignerAddress();case 4:return t.t2=t.sent,t.next=7,t.t0.verify.call(t.t0,t.t1,t.t2);case 7:return t.next=9,a.getBidBufferBps();case 9:return e=t.sent,t.abrupt("return",b.T.fromContractWrapper({contractWrapper:a.contractWrapper,method:"setAuctionBuffers",args:[p.O$.from(r),e]}));case 11:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"allowListingFromSpecificAssetOnly",(0,b.d)(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[],t.next=3,a.roles.get("asset");case 3:return t.sent.includes(l.d)&&e.push(a.encoder.encode("revokeRole",[(0,w.H)("asset"),l.d])),e.push(a.encoder.encode("grantRole",[(0,w.H)("asset"),r])),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:a.contractWrapper,method:"multicall",args:[e]}));case 7:case"end":return t.stop()}}),t)})));return function(r){return t.apply(this,arguments)}}())),(0,u.Z)(this,"allowListingFromAnyAsset",(0,b.d)((0,i.Z)((0,s.Z)().mark((function t(){var r,e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],t.next=3,a.roles.get("asset");case 3:for(e in t.sent)r.push(a.encoder.encode("revokeRole",[(0,w.H)("asset"),e]));return r.push(a.encoder.encode("grantRole",[(0,w.H)("asset"),l.d])),t.abrupt("return",b.T.fromContractWrapper({contractWrapper:a.contractWrapper,method:"multicall",args:[r]}));case 7:case"end":return t.stop()}}),t)})))));var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new w.cq(r,e,d,o,n);this._chainId=f,this.abi=w.bj.parse(d||[]),this.contractWrapper=h,this.storage=n,this.metadata=new y.C(this.contractWrapper,w.bZ,this.storage),this.app=new y.b(this.contractWrapper,this.metadata,this.storage),this.roles=new A.C(this.contractWrapper,t.contractRoles),this.encoder=new x.C(this.contractWrapper),this.estimator=new y.G(this.contractWrapper),this.direct=new O(this.contractWrapper,this.storage),this.auction=new I(this.contractWrapper,this.storage),this.events=new y.a(this.contractWrapper),this.platformFees=new W.C(this.contractWrapper),this.interceptor=new Z.C(this.contractWrapper)}return(0,o.Z)(t,[{key:"chainId",get:function(){return this._chainId}},{key:"onNetworkUpdated",value:function(t){this.contractWrapper.updateSignerOrProvider(t)}},{key:"getAddress",value:function(){return this.contractWrapper.address}},{key:"getListing",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("listings",[r]);case 2:if((e=t.sent).assetContract!==l.d){t.next=5;break}throw new w.L(this.getAddress(),r.toString());case 5:t.t0=e.listingType,t.next=t.t0===L.Auction?8:t.t0===L.Direct?11:14;break;case 8:return t.next=10,this.auction.mapListing(e);case 10:case 13:return t.abrupt("return",t.sent);case 11:return t.next=13,this.direct.mapListing(e);case 14:throw new Error("Unknown listing type: ".concat(e.listingType));case 15:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getActiveListings",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllListingsNoFilter(!0);case 2:return e=t.sent,n=this.applyFilter(e,r),a=p.O$.from(Math.floor(Date.now()/1e3)),t.abrupt("return",n.filter((function(t){return t.type===L.Auction&&p.O$.from(t.endTimeInEpochSeconds).gt(a)&&p.O$.from(t.startTimeInEpochSeconds).lte(a)||t.type===L.Direct&&p.O$.from(t.quantity).gt(0)})));case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllListings",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllListingsNoFilter(!1);case 2:return e=t.sent,t.abrupt("return",this.applyFilter(e,r));case 4:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getTotalCount",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("totalListings",[]);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"isRestrictedToListerRoleOnly",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){var r;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractWrapper.read("hasRole",[(0,w.H)("lister"),l.d]);case 2:return r=t.sent,t.abrupt("return",!r);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getBidBufferBps",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.read("bidBufferBps",[]));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getTimeBufferInSeconds",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.read("timeBuffer",[]));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getOffers",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.events.getEvents("NewOffer",{order:"desc",filters:{listingId:r}});case 2:return e=t.sent,t.next=5,Promise.all(e.map((function(t){return(0,k.m)(n.contractWrapper.getProvider(),p.O$.from(r),{quantityWanted:t.data.quantityWanted,pricePerToken:t.data.quantityWanted.gt(0)?t.data.totalOfferAmount.div(t.data.quantityWanted):t.data.totalOfferAmount,currency:t.data.currency,offeror:t.data.offeror})})));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"getAllListingsNoFilter",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r){var e,n=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Promise,t.t1=Array,t.t2=Array,t.next=5,this.contractWrapper.read("totalListings",[]);case 5:return t.t3=t.sent.toNumber(),t.t4=(0,t.t2)(t.t3).keys(),t.t5=t.t1.from.call(t.t1,t.t4).map(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(e){var a,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.getListing(e);case 3:a=t.sent,t.next=14;break;case 6:if(t.prev=6,t.t0=t.catch(0),!(t.t0 instanceof w.L)){t.next=12;break}return t.abrupt("return",void 0);case 12:return console.warn("Failed to get listing ".concat(e,"' - skipping. Try 'marketplace.getListing(").concat(e,")' to get the underlying error.")),t.abrupt("return",void 0);case 14:if(a.type!==L.Auction){t.next=16;break}return t.abrupt("return",a);case 16:if(!r){t.next=23;break}return t.next=19,n.direct.isStillValidListing(a);case 19:if(i=t.sent,i.valid){t.next=23;break}return t.abrupt("return",void 0);case 23:return t.abrupt("return",a);case 24:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(r){return t.apply(this,arguments)}}()),t.next=10,t.t0.all.call(t.t0,t.t5);case 10:return e=t.sent,t.abrupt("return",e.filter((function(t){return void 0!==t})));case 12:case"end":return t.stop()}}),t,this)})));return function(r){return t.apply(this,arguments)}}()},{key:"applyFilter",value:function(t,r){var e=(0,n.Z)(t),a=p.O$.from((null===r||void 0===r?void 0:r.start)||0).toNumber(),s=p.O$.from((null===r||void 0===r?void 0:r.count)||m.D).toNumber();return r&&(r.seller&&(e=e.filter((function(t){var e;return t.sellerAddress.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.seller)||void 0===e?void 0:e.toString().toLowerCase())}))),r.tokenContract&&(e=e.filter((function(t){var e;return t.assetContractAddress.toString().toLowerCase()===(null===r||void 0===r||null===(e=r.tokenContract)||void 0===e?void 0:e.toString().toLowerCase())}))),void 0!==r.tokenId&&(e=e.filter((function(t){var e;return t.tokenId.toString()===(null===r||void 0===r||null===(e=r.tokenId)||void 0===e?void 0:e.toString())}))),e=(e=e.filter((function(t,r){return r>=a}))).slice(0,s)),e}},{key:"prepare",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,n){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b.T.fromContractWrapper({contractWrapper:this.contractWrapper,method:r,args:e,overrides:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(r,e,n){return t.apply(this,arguments)}}()},{key:"call",value:function(){var t=(0,i.Z)((0,s.Z)().mark((function t(r,e,n){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractWrapper.call(r,e,n));case 1:case"end":return t.stop()}}),t,this)})));return function(r,e,n){return t.apply(this,arguments)}}()}]),t}();(0,u.Z)(S,"contractRoles",w.dC)},75580:function(t,r,e){e.d(r,{B:function(){return p},C:function(){return l},N:function(){return f},a:function(){return d},s:function(){return h}});var n=e(74165),a=e(15861),s=e(68365),i=e(60874),c=e(31714),o=function(){return i.z.object({}).catchall(i.z.union([s.cw,i.z.unknown()]))}(),u=function(){return i.z.union([i.z.array(o),o]).optional().nullable()}(),p=function(){return i.z.object({name:i.z.union([i.z.string(),i.z.number()]).optional().nullable(),description:i.z.string().nullable().optional().nullable(),image:s.cx.nullable().optional(),animation_url:s.cx.optional().nullable()})}(),d=function(){return p.extend({external_url:s.cx.nullable().optional(),background_color:s.cy.optional().nullable(),properties:u,attributes:u}).catchall(i.z.union([s.cw,i.z.unknown()]))}(),f=function(){return i.z.union([d,i.z.string()])}(),l=function(){return d.extend({id:i.z.string(),uri:i.z.string(),image:i.z.string().nullable().optional(),external_url:i.z.string().nullable().optional(),animation_url:i.z.string().nullable().optional()})}();function h(t,r,e,n){return v.apply(this,arguments)}function v(){return(v=(0,a.Z)((0,n.Z)().mark((function t(r,a,i,o){var u,p,d,f,l,h;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,c.i)(i)){t.next=4;break}o.value=a,t.next=21;break;case 4:return t.next=6,Promise.resolve().then(e.t.bind(e,49242,19));case 6:return u=t.sent.default,p=r.getSigner(),d=r.getProvider(),f=new s.cq(p||d,i,u,r.options,r.storage),t.next=12,r.getSignerAddress();case 12:return l=t.sent,h=r.address,t.next=16,f.read("allowance",[l,h]);case 16:if(!t.sent.lt(a)){t.next=20;break}return t.next=20,f.sendTransaction("approve",[h,a]);case 20:return t.abrupt("return",o);case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=1377.82361fab.chunk.js.map