"use strict";(self.webpackChunkgeoblocs=self.webpackChunkgeoblocs||[]).push([[6186],{6186:function(e,t,n){n.r(t),n.d(t,{WalletConnectConnector:function(){return I}});var r=n(84506),i=n(29439),s=n(74165),a=n(15861),o=n(1413),c=n(15671),u=n(43144),h=n(97326),p=n(60136),d=n(29388),v=n(2600),f=n(38690),l=n(97419),m=n(60723),g=n(49716),x=n(32928),w=n(83506),_=n(69822),Z=(n(65892),new Set([1,137,10,42161,56])),k="eip155",C="wagmi.requestedChains",b="wallet_addEthereumChain",y="last-used-chain-id",I=function(e){(0,p.Z)(_,e);var t=(0,d.Z)(_);function _(e){var n;return(0,c.Z)(this,_),n=t.call(this,(0,o.Z)((0,o.Z)({},e),{},{options:(0,o.Z)({isNewChainsStale:!0},e.options)})),(0,v._)((0,h.Z)(n),"id",x.w.walletConnect),(0,v._)((0,h.Z)(n),"name","WalletConnect"),(0,v._)((0,h.Z)(n),"ready",!0),(0,v._)((0,h.Z)(n),"onAccountsChanged",(function(e){0===e.length?n.emit("disconnect"):e[0]&&n.emit("change",{account:l.getAddress(e[0])})})),(0,v._)((0,h.Z)(n),"onChainChanged",function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Number(t),i=n.isChainUnsupported(r),e.next=4,n._storage.setItem(y,String(t));case 4:n.emit("change",{chain:{id:r,unsupported:i}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,v._)((0,h.Z)(n),"onDisconnect",(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._setRequestedChainsIds([]);case 2:return e.next=4,n._storage.removeItem(y);case 4:n.emit("disconnect");case 5:case"end":return e.stop()}}),e)})))),(0,v._)((0,h.Z)(n),"onDisplayUri",(function(e){n.emit("message",{type:"display_uri",data:e})})),(0,v._)((0,h.Z)(n),"onConnect",(function(){n.emit("connect",{provider:n._provider})})),n._storage=e.options.storage,n._createProvider(),n.filteredChains=n.chains.length>50?n.chains.filter((function(e){return Z.has(e.chainId)})):n.chains,n.showWalletConnectModal=!1!==n.options.qrcode,n}return(0,u.Z)(_,[{key:"connect",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r,i,a,o,c,u,h,p,d,v,g,x,w=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=w.length>0&&void 0!==w[0]?w[0]:{}).chainId,r=t.pairingTopic,e.prev=1,i=n){e.next=9;break}return e.next=6,this._storage.getItem(y);case 6:a=e.sent,o=a?parseInt(a):void 0,i=o&&!this.isChainUnsupported(o)?o:null===(c=this.filteredChains[0])||void 0===c?void 0:c.chainId;case 9:if(i){e.next=11;break}throw new Error("No chains found on connector.");case 11:return e.next=13,this.getProvider();case 13:return u=e.sent,this.setupListeners(),e.next=17,this._isChainsStale();case 17:if(h=e.sent,!u.session||!h){e.next=21;break}return e.next=21,u.disconnect();case 21:if(u.session&&!h){e.next=28;break}return p=this.filteredChains.filter((function(e){return e.chainId!==i})).map((function(e){return e.chainId})),this.emit("message",{type:"connecting"}),e.next=26,u.connect({pairingTopic:r,chains:[i],optionalChains:p.length>0?p:[i]});case 26:return e.next=28,this._setRequestedChainsIds(this.filteredChains.map((function(e){return e.chainId})));case 28:return e.next=30,u.enable();case 30:if((d=e.sent)[0]){e.next=33;break}throw new Error("No accounts found on provider.");case 33:return v=l.getAddress(d[0]),e.next=36,this.getChainId();case 36:return g=e.sent,x=this.isChainUnsupported(g),e.abrupt("return",{account:v,chain:{id:g,unsupported:x},provider:new m.Q(u)});case 41:if(e.prev=41,e.t0=e.catch(1),!/user rejected/i.test(null===e.t0||void 0===e.t0?void 0:e.t0.message)){e.next=45;break}throw new f.U(e.t0);case 45:throw e.t0;case 46:case"end":return e.stop()}}),e,this,[[1,41]])})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r,i=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=function(){if("undefined"!==typeof localStorage)for(var e in localStorage)e.startsWith("wc@2")&&localStorage.removeItem(e)})(),e.next=4,this.getProvider();case 4:n=e.sent,r=function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.disconnect();case 3:e.next=9;break;case 5:if(e.prev=5,e.t0=e.catch(0),/No matching key/i.test(e.t0.message)){e.next=9;break}throw e.t0;case 9:return e.prev=9,i._removeListeners(),e.next=13,i._setRequestedChainsIds([]);case 13:return t(),e.finish(9);case 15:case"end":return e.stop()}}),e,null,[[0,5,9,15]])})));return function(){return e.apply(this,arguments)}}(),r();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAccount",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getProvider();case 2:if(t=e.sent,(n=t.accounts)[0]){e.next=6;break}throw new Error("No accounts found on provider.");case 6:return e.abrupt("return",l.getAddress(n[0]));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainId",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getProvider();case 2:return t=e.sent,n=t.chainId,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getProvider",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(n.length>0&&void 0!==n[0]?n[0]:{}).chainId,this._provider){e.next=4;break}return e.next=4,this._createProvider();case 4:if(!t){e.next=7;break}return e.next=7,this.switchChain(t);case 7:if(this._provider){e.next=9;break}throw new Error("No provider found.");case 9:return e.abrupt("return",this._provider);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSigner",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r,a,o,c=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(c.length>0&&void 0!==c[0]?c[0]:{}).chainId,e.next=3,Promise.all([this.getProvider({chainId:t}),this.getAccount()]);case 3:return n=e.sent,r=(0,i.Z)(n,2),a=r[0],o=r[1],e.abrupt("return",new m.Q(a,t).getSigner(o));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isAuthorized",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r,a,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([this.getAccount(),this.getProvider()]);case 3:return t=e.sent,n=(0,i.Z)(t,2),r=n[0],a=n[1],e.next=9,this._isChainsStale();case 9:if(o=e.sent,r){e.next=12;break}return e.abrupt("return",!1);case 12:if(!o||!a.session){e.next=21;break}return e.prev=13,e.next=16,a.disconnect();case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(13);case 20:return e.abrupt("return",!1);case 21:return e.abrupt("return",!0);case 24:return e.prev=24,e.t1=e.catch(0),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,this,[[0,24],[13,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"switchChain",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,c,u,h,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.chains.find((function(e){return e.chainId===t}))){e.next=3;break}throw new f.S("Chain with ID: ".concat(t,", not found on connector."));case 3:return e.prev=3,e.next=6,this.getProvider();case 6:if(r=e.sent,i=this._getNamespaceChainsIds(),a=this._getNamespaceMethods(),i.includes(t)||!a.includes(b)){e.next=21;break}return c=n.explorers&&n.explorers[0],u=c?{blockExplorerUrls:[c.url]}:{},e.next=15,r.request({method:b,params:[(0,o.Z)({chainId:g.hexValue(n.chainId),chainName:n.name,nativeCurrency:n.nativeCurrency,rpcUrls:(0,w.g)(n)},u)]});case 15:return e.next=17,this._getRequestedChainsIds();case 17:return(h=e.sent).push(t),e.next=21,this._setRequestedChainsIds(h);case 21:return e.next=23,r.request({method:"wallet_switchEthereumChain",params:[{chainId:g.hexValue(t)}]});case 23:return e.abrupt("return",n);case 26:if(e.prev=26,e.t0=e.catch(3),p="string"===typeof e.t0?e.t0:null===e.t0||void 0===e.t0?void 0:e.t0.message,!/user rejected request/i.test(p)){e.next=31;break}throw new f.U(e.t0);case 31:throw new f.S(e.t0);case 32:case"end":return e.stop()}}),e,this,[[3,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createProvider",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._initProviderPromise||(this._initProviderPromise=this.initProvider()),e.abrupt("return",this._initProviderPromise);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initProvider",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,i,a,o,c,u,h,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(5894).then(n.bind(n,75894));case 2:if(t=e.sent,i=t.default,a=t.OPTIONAL_EVENTS,o=t.OPTIONAL_METHODS,c=this.filteredChains.map((function(e){return e.chainId})),u=(0,r.Z)(c),h=u[0],p=u.slice(1),!h){e.next=11;break}return e.next=10,i.init({showQrModal:this.showWalletConnectModal,projectId:this.options.projectId,optionalMethods:o,optionalEvents:a,chains:[h],optionalChains:p,metadata:{name:this.options.dappMetadata.name,description:this.options.dappMetadata.description||"",url:this.options.dappMetadata.url,icons:[this.options.dappMetadata.logoUrl||""]},rpcMap:Object.fromEntries(this.filteredChains.map((function(e){return[e.chainId,e.rpc[0]||""]}))),qrModalOptions:this.options.qrModalOptions});case 10:this._provider=e.sent;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isChainsStale",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t,n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._getNamespaceMethods().includes(b)){e.next=3;break}return e.abrupt("return",!1);case 3:if(this.options.isNewChainsStale){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this._getRequestedChainsIds();case 7:if(t=e.sent,n=this.filteredChains.map((function(e){return e.chainId})),!(r=this._getNamespaceChainsIds()).length||r.some((function(e){return n.includes(e)}))){e.next=12;break}return e.abrupt("return",!1);case 12:return e.abrupt("return",!n.every((function(e){return t.includes(e)})));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setupListeners",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._provider){e.next=2;break}return e.abrupt("return");case 2:this._removeListeners(),this._provider.on("accountsChanged",this.onAccountsChanged),this._provider.on("chainChanged",this.onChainChanged),this._provider.on("disconnect",this.onDisconnect),this._provider.on("session_delete",this.onDisconnect),this._provider.on("display_uri",this.onDisplayUri),this._provider.on("connect",this.onConnect);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_removeListeners",value:function(){this._provider&&(this._provider.removeListener("accountsChanged",this.onAccountsChanged),this._provider.removeListener("chainChanged",this.onChainChanged),this._provider.removeListener("disconnect",this.onDisconnect),this._provider.removeListener("session_delete",this.onDisconnect),this._provider.removeListener("display_uri",this.onDisplayUri),this._provider.removeListener("connect",this.onConnect))}},{key:"_setRequestedChainsIds",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._storage.setItem(C,JSON.stringify(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getRequestedChainsIds",value:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._storage.getItem(C);case 2:return t=e.sent,e.abrupt("return",t?JSON.parse(t):[]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getNamespaceChainsIds",value:function(){var e;if(!this._provider)return[];var t=null===(e=this._provider.session)||void 0===e||null===(e=e.namespaces[k])||void 0===e||null===(e=e.chains)||void 0===e?void 0:e.map((function(e){return parseInt(e.split(":")[1]||"")}));return null!==t&&void 0!==t?t:[]}},{key:"_getNamespaceMethods",value:function(){var e;if(!this._provider)return[];var t=null===(e=this._provider.session)||void 0===e||null===(e=e.namespaces[k])||void 0===e?void 0:e.methods;return null!==t&&void 0!==t?t:[]}}]),_}(_.W)}}]);
//# sourceMappingURL=6186.15da8197.chunk.js.map